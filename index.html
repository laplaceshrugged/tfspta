<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Frazer School Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <!-- 3D Tilt Library REMOVED -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        heading: ['Cormorant Garamond', 'serif'],
                    },
                    colors: {
                        brand: {
                            red: '#B91C1C',
                            navy: '#0F172A',
                            grey: '#64748B',
                            lightgrey: '#F1F5F9',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F1F5F9; /* brand-lightgrey */
            color: #64748B; /* brand-grey */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            /* Subtle blueprint grid pattern */
            background-image:
                linear-gradient(rgba(15, 23, 42, 0.04) 1px, transparent 1px),
                linear-gradient(to right, rgba(15, 23, 42, 0.04) 1px, transparent 1px);
            background-size: 30px 30px;
        }
        .heading-font { font-family: 'Cormorant Garamond', serif; }

        .nav-link-style {
            transition: color 0.3s, transform 0.3s;
            position: relative;
            padding-bottom: 4px;
            letter-spacing: 0.5px;
            font-size: 1rem;
            cursor: pointer;
        }
        .nav-link-style::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 50%;
            background-color: #B91C1C; /* brand-red */
            transition: all 0.3s ease-in-out;
            transform: translateX(-50%);
        }
        .nav-link-style:hover::after, .nav-link-style.active::after {
            width: 100%;
            background: radial-gradient(circle, #EF4444 0%, #B91C1C 80%);
            box-shadow: 0 0 8px #EF4444;
        }
        .nav-link-style:hover { color: #FFFFFF; }
        .nav-link-style.active { color: #FFFFFF; font-weight: bold; }

        .btn {
            font-weight: bold;
            border-radius: 9999px;
            padding: 0.8rem 2.5rem;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: inline-block;
            text-align: center;
            cursor: pointer; /* Ensure pointer cursor */
        }
        .btn[disabled] {
             cursor: not-allowed;
             opacity: 0.6;
        }
        .btn-primary {
            background: radial-gradient(circle at center, #DC2626, #B91C1C);
            color: white;
            border: 1px solid #B91C1C;
            box-shadow: 0 0 12px rgba(220, 38, 38, 0.4);
        }
        .btn-primary:hover:not([disabled]) { /* Don't apply hover effect if disabled */
            background: radial-gradient(circle at center, #EF4444, #B91C1C);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: #FFFFFF;
            color: #0F172A; /* brand-navy */
            border: 1px solid #E2E8F0;
        }
        .btn-secondary:hover:not([disabled]) {
            background-color: #F8FAFC;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        #interactive-hero {
            position: relative;
            height: 85vh;
            width: 100%;
            background-color: #0F172A; /* brand-navy */
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            overflow: hidden;
        }
        #hero-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        .hero-text-content { position: relative; z-index: 2; color: white; padding: 2rem; }
        .hero-text-content h1 { font-family: 'Cormorant Garamond', serif; font-size: 3.5rem; font-weight: 700; text-shadow: 2px 2px 8px rgba(0,0,0,0.3); }
        @media (min-width: 768px) {
            .hero-text-content h1 { font-size: 4.5rem; }
            .hero-text-content p { font-size: 1.25rem; }
        }
        .hero-text-content p { font-size: 1.1rem; max-width: 600px; margin: 1rem auto 0; text-shadow: 1px 1px 4px rgba(0,0,0,0.3); }

        /* NEW: Polaroid Card Styles */
        .polaroid-card {
            background-color: white;
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            display: block;
        }
        .polaroid-card:hover {
            transform: scale(1.05) rotate(0deg) !important; /* Straighten and scale on hover */
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            z-index: 10;
            position: relative; /* Bring to front */
        }
        .polaroid-image {
            height: 14rem; /* 224px */
            width: 100%;
            background-size: cover;
            background-position: center;
            border: 1px solid #eee;
        }


        .bento-item {
            background-color: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 8px 30px rgba(15, 23, 42, 0.05);
            position: relative; /* Needed for confetti canvas */
        }

        .leader-card {
            position: relative;
            overflow: hidden;
            border-radius: 0.75rem;
            box-shadow: 0 8px 30px rgba(15, 23, 42, 0.08);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .leader-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(15, 23, 42, 0.12);
        }
        .leader-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .leader-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(15, 23, 42, 0.9) 0%, transparent 100%);
            color: white;
            padding: 2.5rem 1.5rem 1.5rem;
            text-align: left;
        }
        .leader-info h4 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.75rem;
            font-weight: 700;
        }
        .leader-info p {
            color: rgba(255,255,255,0.8);
        }

        .reveal { opacity: 0; transform: translateY(30px); transition: opacity 0.8s, transform 0.8s; transition-timing-function: cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .reveal.visible { opacity: 1; transform: translateY(0); }

        #back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
            transform: translateY(20px);
            z-index: 100;
        }
        #back-to-top.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .angled-section {
            background-color: white;
            padding: 6rem 0;
            position: relative;
        }

        .angled-section::before {
            content: '';
            position: absolute;
            top: -50px;
            left: 0;
            width: 100%;
            height: 50px;
            background-color: white;
            clip-path: polygon(0% 100%, 100% 0%, 100% 100%);
        }

        .sticky-title {
            position: sticky;
            top: 68px; /* Approx height of the main nav bar */
            z-index: 40;
            background-color: #F1F5F9;
            background-image:
                linear-gradient(rgba(15, 23, 42, 0.04) 1px, transparent 1px),
                linear-gradient(to right, rgba(15, 23, 42, 0.04) 1px, transparent 1px);
            background-size: 30px 30px;
            padding-top: 3rem;
            padding-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05);
        }

        @keyframes spin-slow {
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 20s linear infinite;
        }

        #search-overlay, #auth-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        .photo-collage img {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .photo-collage .image-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
        }
        .photo-collage img:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            z-index: 10;
        }
        .image-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.7), transparent);
            color: white;
            padding: 2rem 1rem 1rem;
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
        }
        .image-container:hover .image-overlay {
            transform: translateY(0);
        }
        .confetti-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        /* Style for membership/donation level selection */
        input[type="radio"]:checked + label {
            border-color: #B91C1C;
            box-shadow: 0 0 0 2px #B91C1C;
        }
        input[type="radio"] + label {
            border: 2px solid #E2E8F0;
        }
        
        /* FAQ Accordion Styles */
        details {
            border: 1px solid #E2E8F0;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            overflow: hidden;
        }
        summary {
            display: block;
            cursor: pointer;
            padding: 1rem 1.5rem;
            font-weight: 600;
            color: #0F172A; /* brand-navy */
            background-color: #F8FAFC;
            transition: background-color 0.2s;
        }
        summary:hover {
            background-color: #F1F5F9;
        }
        summary::-webkit-details-marker {
            display: none;
        }
        summary::after {
            content: '\f078'; /* Font Awesome chevron-down */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            float: right;
            transition: transform 0.3s ease;
        }
        details[open] > summary::after {
            transform: rotate(180deg);
        }
        details > div {
            padding: 1rem 1.5rem;
            border-top: 1px solid #E2E8F0;
            background-color: white;
        }
        /* Cart Icon Badge */
        #cart-button {
            position: relative;
        }
        #cart-count {
            position: absolute;
            top: -8px;
            right: -10px;
            background-color: #B91C1C; /* brand-red */
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-brand-navy text-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold flex items-center heading-font transition-opacity hover:opacity-90" id="school-logo" data-clicks="0" data-page="home" aria-label="Frazer School Hub Home">
                <i class="fas fa-star mr-2 text-brand-red" aria-hidden="true"></i> The Frazer School Hub
            </a>
            <div class="hidden md:flex space-x-8 items-center" id="nav-links">
                <a href="#" class="nav-link-style active" data-page="home" role="button">Home</a>
                <a href="#" class="nav-link-style" data-page="pta" role="button">PTA</a>
                <a href="#" class="nav-link-style" data-page="membership" role="button">Membership</a>
                <a href="#" class="nav-link-style" data-page="donate" role="button">Donate</a>
                <a href="#" class="nav-link-style" data-page="store" role="button">Store</a>
                <a href="#" class="nav-link-style" data-page="raffle" role="button">Raffle</a>
                <a href="#" class="nav-link-style" data-page="teams" role="button">Teams</a>
                <a href="#" class="nav-link-style" data-page="clubs" role="button">Clubs</a>
                <a href="#" class="nav-link-style" data-page="upcoming" role="button">Events</a>
                <a href="#" class="nav-link-style" data-page="coaches" role="button">Coaches</a>
                <a href="#" class="nav-link-style" data-page="news" role="button">News</a>
                <a href="#" class="nav-link-style" data-page="home" data-scroll="#contact" role="button">Contact</a>

                <!-- Auth Links -->
                <a href="#" id="portal-link" class="nav-link-style hidden" data-page="portal" role="button">Member Portal</a>
                <button id="login-button" class="btn btn-primary !py-2 !px-6">Member Login</button>
                <button id="logout-button" class="text-xl hover:text-brand-red transition-colors hidden" aria-label="Logout"><i class="fas fa-sign-out-alt"></i></button>

                <button id="cart-button" aria-label="View cart" class="text-xl hover:text-brand-red transition-colors hidden">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cart-count" class="hidden">0</span>
                </button>
                <button id="search-button" aria-label="Open search" class="text-xl hover:text-brand-red transition-colors">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <button id="mobile-menu-button" class="md:hidden" aria-label="Open mobile menu">
                <i class="fas fa-bars text-2xl"></i>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4">
             <a href="#" class="block py-2 nav-link-style" data-page="home" role="button">Home</a>
             <a href="#" class="block py-2 nav-link-style" data-page="pta" role="button">PTA</a>
             <a href="#" class="block py-2 nav-link-style" data-page="membership" role="button">Membership</a>
             <a href="#" class="block py-2 nav-link-style" data-page="donate" role="button">Donate</a>
             <a href="#" class="block py-2 nav-link-style" data-page="store" role="button">Store</a>
             <a href="#" class="block py-2 nav-link-style" data-page="raffle" role="button">Raffle</a>
             <a href="#" class="block py-2 nav-link-style" data-page="teams" role="button">Teams</a>
             <a href="#" class="block py-2 nav-link-style" data-page="clubs" role="button">Clubs</a>
             <a href="#" class="block py-2 nav-link-style" data-page="upcoming" role="button">Events</a>
             <a href="#" class="block py-2 nav-link-style" data-page="coaches" role="button">Coaches</a>
             <a href="#" class="block py-2 nav-link-style" data-page="news" role="button">News</a>
             <a href="#" class="block py-2 nav-link-style" data-page="home" data-scroll="#contact" role="button">Contact</a>
             <hr class="my-2 border-gray-700">
             <a href="#" id="mobile-portal-link" class="block py-2 nav-link-style hidden" data-page="portal">Member Portal</a>
             <a href="#" id="mobile-login-button" class="block py-2 nav-link-style">Member Login</a>
             <a href="#" id="mobile-logout-button" class="block py-2 nav-link-style hidden">Logout</a>
        </div>
    </header>

    <div id="search-overlay" class="fixed inset-0 bg-black bg-opacity-70 z-[60] hidden flex-col items-center p-4">
        <button id="close-search-button" class="absolute top-4 right-4 text-white text-3xl">&times;</button>
        <input type="search" id="search-input" placeholder="Search for teams, clubs, events..." class="w-full max-w-2xl p-4 text-2xl rounded-lg border-none mt-20">
        <div id="search-results-container" class="w-full max-w-2xl mt-4 bg-white rounded-lg p-4 overflow-y-auto">
            <!-- Search results will be injected here -->
        </div>
    </div>

    <!-- Auth Overlay -->
    <div id="auth-overlay" class="fixed inset-0 bg-black bg-opacity-80 z-[60] hidden flex-col items-center justify-center p-4">
        <button id="close-auth-button" class="absolute top-4 right-4 text-white text-4xl">&times;</button>
        <div class="w-full max-w-md bg-white rounded-lg shadow-xl p-8">
            <!-- Login Form -->
            <div id="login-container">
                <h2 class="heading-font text-3xl text-brand-navy text-center mb-6">Member Login</h2>
                <form id="login-form">
                    <div class="mb-4">
                        <label for="login-email" class="block text-brand-navy font-bold mb-2">Email</label>
                        <input type="email" id="login-email" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-red" required>
                    </div>
                    <div class="mb-4"> <!-- Reduced bottom margin -->
                        <label for="login-password" class="block text-brand-navy font-bold mb-2">Password</label>
                        <input type="password" id="login-password" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-red" required>
                    </div>
                    <div class="text-right mb-6">
                        <a href="#" id="forgot-password-link" class="text-sm text-brand-red hover:underline">Forgot Password?</a>
                    </div>
                    <button type="submit" class="btn btn-primary w-full">Log In</button>
                </form>
                <p class="text-center mt-4">
                    Don't have an account? <a href="#" id="show-signup" class="text-brand-red font-bold hover:underline">Sign Up</a>
                </p>
            </div>
            <!-- Signup Form -->
            <div id="signup-container" class="hidden">
                <h2 class="heading-font text-3xl text-brand-navy text-center mb-6">Create Account</h2>
                <form id="signup-form">
                     <div class="mb-4">
                        <label for="signup-name" class="block text-brand-navy font-bold mb-2">Full Name</label>
                        <input type="text" id="signup-name" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-red" required>
                    </div>
                    <div class="mb-4">
                        <label for="signup-email" class="block text-brand-navy font-bold mb-2">Email</label>
                        <input type="email" id="signup-email" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-red" required>
                    </div>
                    <div class="mb-4">
                        <label for="signup-password" class="block text-brand-navy font-bold mb-2">Password</label>
                        <input type="password" id="signup-password" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-red" minlength="6" required>
                        <p class="text-xs text-gray-500 mt-1">Minimum 6 characters</p>
                    </div>
                    <hr class="my-6 border-gray-200">
                    <h3 class="text-lg font-semibold text-brand-navy mb-4">Student Information</h3>
                    <div class="mb-4">
                        <label for="signup-child-name" class="block text-brand-navy font-bold mb-2">Child's Full Name</label>
                        <input type="text" id="signup-child-name" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-red" required>
                    </div>
                     <div class="mb-6">
                        <label for="signup-child-grade" class="block text-brand-navy font-bold mb-2">Child's Grade</label>
                        <select id="signup-child-grade" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-brand-red" required>
                            <option value="">Select Grade</option>
                            <option value="6">6th Grade</option>
                            <option value="7">7th Grade</option>
                            <option value="8">8th Grade</option>
                            <option value="9">9th Grade</option>
                            <option value="10">10th Grade</option>
                            <option value="11">11th Grade</option>
                            <option value="12">12th Grade</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary w-full">Sign Up</button>
                </form>
                <p class="text-center mt-4">
                    Already have an account? <a href="#" id="show-login" class="text-brand-red font-bold hover:underline">Log In</a>
                </p>
            </div>
             <!-- Forgot Password Form (Initially Hidden) -->
            <div id="forgot-password-container" class="hidden">
                <h2 class="heading-font text-3xl text-brand-navy text-center mb-6">Reset Password</h2>
                <form id="forgot-password-form">
                    <div class="mb-6">
                        <label for="reset-email" class="block text-brand-navy font-bold mb-2">Enter your account email</label>
                        <input type="email" id="reset-email" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-red" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-full">Send Reset Link</button>
                </form>
                <p class="text-center mt-4">
                    Remembered your password? <a href="#" id="back-to-login" class="text-brand-red font-bold hover:underline">Log In</a>
                </p>
            </div>
            <p id="auth-message" class="text-center mt-4 font-medium"></p> <!-- Renamed for general messages -->
        </div>
    </div>


    <main>
        <div id="home-page" class="page">
            <section id="interactive-hero" aria-label="Welcome to the Frazer School PTA">
                <canvas id="hero-canvas" aria-hidden="true"></canvas>
                <div class="hero-text-content">
                    <h1 class="reveal">Welcome to The Frazer School PTA</h1>
                    <p class="reveal" style="transition-delay: 200ms;">A dynamic community where student ambition and parent partnership create extraordinary outcomes.</p>
                </div>
            </section>

            <div class="container mx-auto px-6 py-24">
                <section class="mb-24" aria-labelledby="explore-heading">
                    <h2 id="explore-heading" class="heading-font text-4xl text-brand-navy mb-12 text-center">Explore the Hub</h2>
                    <!-- REWORKED this section for Polaroid Effect -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 lg:gap-12 items-center">
                        <a href="#" data-page="teams" class="polaroid-card" style="transform: rotate(-2.5deg);">
                            <div class="polaroid-image" style="background-image: url('https://images.unsplash.com/photo-1577896851231-70ef18881754?auto=format&fit=crop&q=80&w=600&h=400');"></div>
                            <div class="pt-4 text-center">
                                <h3 class="heading-font text-2xl text-brand-navy">Teams</h3>
                                <p class="text-brand-grey text-sm">Discover our academic teams.</p>
                            </div>
                        </a>
                         <a href="#" data-page="clubs" class="polaroid-card" style="transform: rotate(1.5deg);">
                            <div class="polaroid-image" style="background-image: url('https://images.unsplash.com/photo-1503676260728-1c00da094a0b?auto=format&fit=crop&q=80&w=600&h=400');"></div>
                            <div class="pt-4 text-center">
                                <h3 class="heading-font text-2xl text-brand-navy">Clubs</h3>
                                <p class="text-brand-grey text-sm">Find your passion after school.</p>
                            </div>
                        </a>
                         <a href="#" data-page="upcoming" class="polaroid-card" style="transform: rotate(-1deg);">
                            <div class="polaroid-image" style="background-image: url('https://images.unsplash.com/photo-1517457373958-b7bdd4587205?auto=format&fit=crop&q=80&w=600&h=400');"></div>
                            <div class="pt-4 text-center">
                                <h3 class="heading-font text-2xl text-brand-navy">Events</h3>
                                <p class="text-brand-grey text-sm">See our community calendar.</p>
                            </div>
                        </a>
                         <a href="#" data-page="pta" class="polaroid-card" style="transform: rotate(3deg);">
                            <div class="polaroid-image" style="background-image: url('https://images.unsplash.com/photo-1529070538774-1843cb3265df?auto=format&fit=crop&q=80&w=600&h=400');"></div>
                            <div class="pt-4 text-center">
                                <h3 class="heading-font text-2xl text-brand-navy">PTA</h3>
                                <p class="text-brand-grey text-sm">Partnering for student success.</p>
                            </div>
                        </a>
                    </div>
                </section>
                
                <section class="mb-24" aria-labelledby="up-next-heading">
                    <h2 id="up-next-heading" class="heading-font text-4xl text-brand-navy mb-12 text-center">Up Next at Frazer</h2>
                    <div id="up-next-event" class="bento-item text-center">
                        <p>Loading upcoming event...</p>
                    </div>
                </section>

                <section id="announcements-section" class="mb-24" aria-labelledby="announcements-heading">
                    <h2 id="announcements-heading" class="heading-font text-4xl text-brand-navy mb-12 text-center">Latest Announcements</h2>
                    <div id="announcements-grid" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 bento-item reveal">
                            <canvas id="confetti-canvas" class="confetti-canvas"></canvas>
                            <div class="relative z-10">
                                <h3 class="heading-font text-3xl text-brand-navy mb-4">Debate Team Wins State Championship!</h3>
                                <p class="text-lg">Our incredible Debate Team secured first place at the state championship last weekend. Their dedication, sharp arguments, and countless hours of practice have made our entire school community proud. This victory is a testament to their hard work and the excellent guidance of their coaches.</p>
                                <a href="#" class="btn btn-primary mt-6" data-page="news-detail" data-news="Debate Team Wins State Championship!">Read More</a>
                            </div>
                        </div>
                        <div class="space-y-8">
                            <div class="bento-item reveal">
                                <h3 class="heading-font text-2xl text-brand-navy mb-2">Volunteer Spotlight</h3>
                                <p>A huge thank you to Jane Doe for her tireless work organizing the community movie night. Our volunteers are the best!</p>
                            </div>
                            <div class="bento-item reveal">
                                <h3 class="heading-font text-2xl text-brand-navy mb-2">From the Principal</h3>
                                <p>"Every achievement is a testament to the collaborative spirit of our students, parents, and staff. I am immensely proud of what we accomplish together."</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mb-24" aria-labelledby="moments-heading">
                    <h2 id="moments-heading" class="heading-font text-4xl text-brand-navy mb-12 text-center">Moments at Frazer</h2>
                    <div class="photo-collage grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="image-container shadow-md">
                            <img src="https://images.unsplash.com/photo-1509062522246-3755977927d7?auto=format&fit=crop&q=80&w=600&h=400" alt="Teacher with students" class="w-full h-full object-cover">
                            <div class="image-overlay">
                                <h4 class="font-bold mb-1">Teacher Excellence</h4>
                                <p class="text-sm">Our dedicated teachers go above and beyond, earning state recognition for innovative teaching methods and student engagement.</p>
                            </div>
                        </div>
                        <div class="image-container shadow-md row-span-2">
                            <img src="https://images.unsplash.com/photo-1581092918056-0c4c3acd3789?auto=format&fit=crop&q=80&w=600&h=800" alt="Robotics team working" class="w-full h-full object-cover">
                            <div class="image-overlay">
                                <h4 class="font-bold mb-1">Robotics Team Champions</h4>
                                <p class="text-sm">Our award-winning robotics team showcases engineering excellence, winning the State Championships and advancing to nationals.</p>
                            </div>
                        </div>
                        <div class="image-container shadow-md">
                            <img src="https://images.unsplash.com/photo-1509062522246-3755977927d7?auto=format&fit=crop&q=80&w=600&h=400" alt="Math team competition" class="w-full h-full object-cover">
                            <div class="image-overlay">
                                <h4 class="font-bold mb-1">Math Team Excellence</h4>
                                <p class="text-sm">The Math Team's dedication leads to consistent top rankings in regional competitions and MathCounts championships.</p>
                            </div>
                        </div>
                        <div class="image-container shadow-md">
                            <img src="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?auto=format&fit=crop&q=80&w=600&h=400" alt="Debate team in action" class="w-full h-full object-cover">
                            <div class="image-overlay">
                                <h4 class="font-bold mb-1">Debate Team Victory</h4>
                                <p class="text-sm">Our debate team's recent state championship victory showcases their exceptional research and public speaking skills.</p>
                            </div>
                        </div>
                        <div class="image-container shadow-md">
                            <img src="https://images.unsplash.com/photo-1577896851231-70ef18881754?auto=format&fit=crop&q=80&w=600&h=400" alt="Student government meeting" class="w-full h-full object-cover">
                            <div class="image-overlay">
                                <h4 class="font-bold mb-1">Student Leadership</h4>
                                <p class="text-sm">Our Student Government actively shapes school policy and organizes initiatives that enhance student life.</p>
                            </div>
                        </div>
                        <div class="image-container shadow-md">
                            <img src="https://images.unsplash.com/photo-1511795409834-ef04bbd61622?auto=format&fit=crop&q=80&w=600&h=400" alt="Spirit night celebration" class="w-full h-full object-cover">
                            <div class="image-overlay">
                                <h4 class="font-bold mb-1">Spirit Night</h4>
                                <p class="text-sm">Our annual Spirit Night brings together students, teachers, and families to celebrate school pride and community.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="bento-item text-center reveal mb-24" aria-labelledby="get-involved-cta">
                    <h2 id="get-involved-cta" class="heading-font text-3xl text-brand-navy">Ready to Get Involved?</h2>
                    <p class="text-lg my-4 max-w-2xl mx-auto">Your participation is key to our success. Join the PTA or volunteer your time to make a difference in our school community.</p>
                    <div class="flex flex-wrap gap-4 justify-center">
                        <a href="#" class="btn btn-primary" data-page="membership" role="button">Become a Member</a>
                        <a href="#" class="btn btn-secondary" data-page="portal" role="button">Volunteer</a>
                    </div>
                </section>

                <section id="contact" class="angled-section reveal" aria-labelledby="contact-heading">
                    <div class="container mx-auto px-6 text-center">
                        <h2 id="contact-heading" class="heading-font text-4xl text-brand-navy">Contact Us</h2>
                        <p class="text-lg mt-2">Have questions or ideas? We'd love to hear from you!</p>
                        <div class="w-24 h-1 bg-brand-red mx-auto mt-4 rounded mb-8"></div>

                        <form action="#" class="max-w-xl mx-auto text-left">
                            <div class="mb-4">
                                <label for="name" class="block text-brand-navy font-bold mb-2">Name</label>
                                <input type="text" id="name" name="name" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-red" required>
                            </div>
                            <div class="mb-4">
                                <label for="email" class="block text-brand-navy font-bold mb-2">Email</label>
                                <input type="email" id="email" name="email" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-red" required>
                            </div>
                            <div class="mb-4">
                                <label for="subject" class="block text-brand-navy font-bold mb-2">Subject</label>
                                <select id="subject" name="subject" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-brand-red">
                                    <option>PTA Membership</option>
                                    <option>Volunteering</option>
                                    <option>General Question</option>
                                </select>
                            </div>
                            <div class="mb-6">
                                <label for="message" class="block text-brand-navy font-bold mb-2">Message</label>
                                <textarea id="message" name="message" rows="5" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-red" required></textarea>
                            </div>
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary">Send Message</button>
                            </div>
                        </form>
                    </div>
                </section>
            </div>
        </div>

        <div id="coaches-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="coaches-heading">
            <h1 id="coaches-heading" class="heading-font text-4xl text-brand-navy text-center reveal sticky-title">Coaches</h1>
            <div class="pt-8">
                <section class="mb-16">
                    <h2 class="heading-font text-3xl text-brand-navy mb-8 text-center">Math Coaches</h2>
                    <div id="math-coaches-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                        <!-- Math Coach cards will be dynamically inserted here -->
                    </div>
                </section>

                <section class="mb-16">
                    <h2 class="heading-font text-3xl text-brand-navy mb-8 text-center">Science Coaches</h2>
                    <div id="science-coaches-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                        <!-- Science Coach cards will be dynamically inserted here -->
                    </div>
                </section>

                <section>
                    <h2 class="heading-font text-3xl text-brand-navy mb-8 text-center">Miscellaneous Coaches</h2>
                    <div id="misc-coaches-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                        <!-- Miscellaneous Coach cards will be dynamically inserted here -->
                    </div>
                </section>
            </div>
        </div>


        <div id="teams-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="teams-heading">
            <h1 id="teams-heading" class="heading-font text-4xl text-brand-navy text-center reveal sticky-title">List of Academic Teams</h1>
            <div class="pt-8">
                <p class="text-lg text-center max-w-3xl mx-auto mb-12">The Frazer School competes in numerous academic competitions in subjects ranging from math to geography.</p>
                <div id="teams-grid-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12">
                    <p>Loading teams...</p>
                </div>
            </div>
        </div>

        <div id="team-detail-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="team-detail-heading">
             <div class="sticky-title mb-8">
                 <nav id="breadcrumb-nav" aria-label="Breadcrumb" class="text-center"></nav>
            </div>
            <div class="max-w-4xl mx-auto">
                <h1 id="team-detail-heading" class="heading-font text-4xl text-brand-navy mb-8 text-center"></h1>
                <section class="mb-12">
                    <h2 class="heading-font text-3xl text-brand-navy mb-4">What is it?</h2>
                    <p id="team-detail-what" class="text-lg leading-relaxed"></p>
                </section>
                <section class="mb-12">
                    <h2 class="heading-font text-3xl text-brand-navy mb-4">What We Do</h2>
                    <p id="team-detail-do" class="text-lg leading-relaxed"></p>
                </section>
                <section class="mb-12 bg-white p-8 rounded-lg shadow-md">
                    <h2 class="heading-font text-3xl text-brand-navy mb-4">Meet Our Coaches</h2>
                    <div id="team-detail-coaches" class="grid grid-cols-1 sm:grid-cols-2 gap-8"></div>
                </section>
                <section>
                    <h2 class="heading-font text-3xl text-brand-navy mb-4">Awards</h2>
                    <div id="team-detail-awards" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <!-- Award images will be dynamically inserted here -->
                    </div>
                </section>
            </div>
        </div>

        <div id="clubs-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="clubs-heading">
            <h1 id="clubs-heading" class="heading-font text-4xl text-brand-navy text-center reveal sticky-title">After School Clubs</h1>
            <div class="pt-8">
                <p class="text-lg text-center max-w-3xl mx-auto mb-12">Explore a variety of after-school clubs to pursue your passions, learn new skills, and connect with fellow students.</p>
                <div id="clubs-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <p>Loading clubs...</p>
                </div>
            </div>
        </div>

        <div id="club-detail-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="club-detail-heading">
             <div class="sticky-title mb-8">
                 <nav id="club-breadcrumb-nav" aria-label="Breadcrumb" class="text-center"></nav>
            </div>
            <div class="max-w-4xl mx-auto">
                <h1 id="club-detail-heading" class="heading-font text-4xl text-brand-navy mb-8 text-center"></h1>
                <section class="mb-12">
                    <h2 class="heading-font text-3xl text-brand-navy mb-4">Club Description</h2>
                    <p id="club-detail-description" class="text-lg leading-relaxed"></p>
                </section>
                <section class="mb-12">
                    <h2 class="heading-font text-3xl text-brand-navy mb-4">Meeting Information</h2>
                    <p id="club-detail-meetings" class="text-lg leading-relaxed"></p>
                </section>
                <section class="mb-12 bg-white p-8 rounded-lg shadow-md">
                    <h2 class="heading-font text-3xl text-brand-navy mb-4">Faculty Sponsor</h2>
                    <div id="club-detail-sponsor"></div>
                </section>
                <section>
                    <h2 class="heading-font text-3xl text-brand-navy mb-4">Photo Gallery</h2>
                    <div id="club-detail-gallery" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <!-- Club images will be dynamically inserted here -->
                    </div>
                </section>
            </div>
        </div>


        <div id="upcoming-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="upcoming-events-heading">
            <h1 id="upcoming-events-heading" class="heading-font text-4xl text-brand-navy text-center reveal sticky-title">Upcoming Events</h1>
            <div class="pt-8">
                <p class="text-lg text-center max-w-3xl mx-auto mb-12">Here is a visual overview of our school's schedule. Scroll down for highlighted event details and to add them to your personal calendar.</p>

                <div class="bg-white rounded-lg shadow-xl overflow-hidden p-4 mb-16">
                    <iframe src="https://calendar.google.com/calendar/embed?src=en.usa%23holiday%40group.v.calendar.google.com&ctz=America%2FNew_York" style="border: 0" width="100%" height="600" frameborder="0" scrolling="no"></iframe>
                </div>

                <h2 class="heading-font text-3xl text-brand-navy mb-12 text-center">Event Highlights</h2>
                <div id="events-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <p>Loading events...</p>
                </div>
            </div>
        </div>

        <div id="news-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="news-heading">
            <h1 id="news-heading" class="heading-font text-4xl text-brand-navy text-center reveal sticky-title">Latest News</h1>
            <div id="news-grid" class="pt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <p>Loading news...</p>
            </div>
        </div>

        <div id="news-detail-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="news-detail-heading">
            <div class="sticky-title mb-8">
                <nav id="news-breadcrumb-nav" aria-label="Breadcrumb" class="text-center"></nav>
           </div>
           <div class="max-w-4xl mx-auto bg-white p-8 sm:p-12 rounded-lg shadow-xl">
               <h1 id="news-detail-heading" class="heading-font text-4xl text-brand-navy mb-4"></h1>
               <p id="news-detail-meta" class="text-sm text-gray-500 mb-6"></p>
               <img id="news-detail-image" src="" alt="Article image" class="rounded-lg mb-8 w-full h-auto object-cover">
               <div id="news-detail-content" class="text-lg leading-relaxed space-y-6"></div>
           </div>
       </div>

        <div id="pta-page" class="hidden page" aria-labelledby="pta-heading">
             <h1 id="pta-heading" class="heading-font text-4xl text-brand-navy text-center reveal sticky-title">Parent–Teacher Association</h1>
            <div class="pt-8">
                <section id="president-message" class="angled-section" aria-labelledby="president-message-heading">
                    <div class="container mx-auto px-6 reveal">
                        <div class="grid md:grid-cols-2 gap-12 items-center">
                            <div class="text-center md:order-2">
                                <img src="https://images.unsplash.com/photo-1573496799652-408c2ac9fe98?auto=format&fit=crop&q=80&w=400&h=500" alt="Portrait of Han Yi, PTA President" class="rounded-full w-64 h-64 mx-auto shadow-xl object-cover object-top">
                            </div>
                            <div class="md:order-1 text-left">
                                <h2 id="president-message-heading" class="heading-font text-4xl text-brand-navy mb-6">Message from the PTA President</h2>
                                <div class="space-y-4 text-lg">
                                    <p>Dear Frazer School Families,</p>
                                    <p>Welcome to a new school year at The Frazer School! As your inaugural year PTA President, I am thrilled to embark on this exciting journey with each of you. Our PTA is dedicated to enriching the educational experience of our students through supportive community efforts and enriching programs.</p>
                                    <p>We are eager to introduce several new initiatives to support our students and teachers in their journey to make this a memorable experience. We believe that strong community ties are the key to our children’s success, and we invite you to join us in making this year exceptional.</p>
                                    <p>Please consider participating in our upcoming events and volunteering opportunities. Your involvement is crucial to our success and provides invaluable support to our students and faculty.</p>
                                    <p>Thank you for being an integral part of our school community. Together, we will make this a fantastic year for our children!</p>
                                    <p class="font-bold mt-6">Warm regards,<br>Han Yi<br>PTA President, Frazer School</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="pta-mission" class="angled-section" aria-labelledby="mission-heading">
                    <div class="container mx-auto px-6 reveal">
                        <div class="text-center max-w-4xl mx-auto">
                            <h2 id="mission-heading" class="heading-font text-4xl text-brand-navy mb-6">Our Mission</h2>
                            <p class="text-xl mb-12 leading-relaxed">The mission of the Frazer School's Parent–Teacher Association (PTA) is to unlock Frazer School students' potential by engaging families and communities to advocate for and foster each child's unique talents, enabling them to succeed in a global society.</p>
                        </div>
                        <div class="grid md:grid-cols-3 gap-8 text-center">
                            <div class="bento-item">
                                <i class="fas fa-seedling text-4xl text-brand-red mb-4"></i>
                                <h3 class="heading-font text-2xl text-brand-navy mb-2">Support Student Growth</h3>
                                <p>We create learning opportunities for all children.</p>
                            </div>
                            <div class="bento-item">
                                <i class="fas fa-users text-4xl text-brand-red mb-4"></i>
                                <h3 class="heading-font text-2xl text-brand-navy mb-2">Build Community</h3>
                                <p>Engagement fosters academic and social development.</p>
                            </div>
                            <div class="bento-item">
                                <i class="fas fa-handshake text-4xl text-brand-red mb-4"></i>
                                <h3 class="heading-font text-2xl text-brand-navy mb-2">Nurture School Ties</h3>
                                <p>Strengthening bonds between families and educators.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="flywheel" class="angled-section" aria-labelledby="flywheel-heading">
                    <div class="container mx-auto px-6 reveal text-center">
                        <h2 id="flywheel-heading" class="heading-font text-4xl text-brand-navy mb-6">The Frazer School "Flywheel"</h2>
                        <div class="flex justify-center mb-8">
                            <img src="PTAFlywheel.png" alt="PTA Flywheel Diagram" class="w-96 h-auto animate-spin-slow">
                        </div>
                        <p class="text-xl max-w-4xl mx-auto leading-relaxed">The philosophy of the new Frazer School is to foster academic excellence through the powerful synergy of dedicated students, passionate teachers, and supportive parents. Like a "flywheel," this synergy creates a virtuous cycle that drives continuous success for both the school and its students.</p>
                    </div>
                </section>

                <section id="committees" class="angled-section" aria-labelledby="committees-heading">
                        <div class="container mx-auto px-6 reveal">
                            <h2 id="committees-heading" class="heading-font text-4xl text-brand-navy mb-12 text-center">Our Committees</h2>
                            <div class="grid md:grid-cols-2 gap-8 text-center">
                                 <div class="bento-item">
                                     <i class="fas fa-hand-holding-usd text-4xl text-brand-red mb-4"></i>
                                     <h3 class="heading-font text-2xl text-brand-navy mb-2">Fundraising Committee</h3>
                                     <p>Through fundraising, we provide essential programs and resources that enrich student learning opportunities and experiences.</p>
                                 </div>
                                 <div class="bento-item">
                                     <i class="fas fa-trophy text-4xl text-brand-red mb-4"></i>
                                     <h3 class="heading-font text-2xl text-brand-navy mb-2">Competition Committee</h3>
                                     <p>Our goal is to support students as they prepare for and participate in regional and national-level competitions.</p>
                                 </div>
                                 <div class="bento-item">
                                     <i class="fas fa-calendar-alt text-4xl text-brand-red mb-4"></i>
                                     <h3 class="heading-font text-2xl text-brand-navy mb-2">Program and Event Committee</h3>
                                     <p>We organize events that foster community engagement and enhance the educational experience for all students.</p>
                                 </div>
                                 <div class="bento-item">
                                     <i class="fas fa-bullhorn text-4xl text-brand-red mb-4"></i>
                                     <h3 class="heading-font text-2xl text-brand-navy mb-2">Communication Committee</h3>
                                     <p>We promote school spirit and strengthen communication between families and educators for a thriving environment.</p>
                                 </div>
                            </div>
                        </div>
                </section>

                <section class="angled-section reveal" aria-labelledby="meet-the-team-heading">
                    <div class="container mx-auto px-6">
                        <h2 id="meet-the-team-heading" class="heading-font text-4xl text-brand-navy mb-12 text-center">Meet the Team</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                            <div class="leader-card reveal">
                                <img src="https://images.unsplash.com/photo-1573496799652-408c2ac9fe98?auto=format&fit=crop&q=80&w=400&h=500" alt="Portrait of Han Yi, PTA President">
                                <div class="leader-info">
                                    <h4>Han Yi</h4>
                                    <p class="mb-2">President</p>
                                    <p class="text-sm leading-tight">With 15 years of experience in education and three children at Frazer, Han brings a unique perspective to the PTA. Her focus on STEM initiatives has helped secure multiple grants for our robotics program.</p>
                                </div>
                            </div>
                            <div class="leader-card reveal" style="transition-delay: 100ms;">
                                <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&q=80&w=400&h=500" alt="Portrait of John Smith, PTA Vice President">
                                <div class="leader-info">
                                    <h4>John Smith</h4>
                                    <p class="mb-2">Vice President</p>
                                    <p class="text-sm leading-tight">A former high school teacher turned tech executive, John leverages his educational background and business acumen to strengthen our community partnerships and fundraising initiatives.</p>
                                </div>
                            </div>
                            <div class="leader-card reveal" style="transition-delay: 200ms;">
                                <img src="https://images.unsplash.com/photo-1580489944761-15a19d654956?auto=format&fit=crop&q=80&w=400&h=500" alt="Portrait of Emily White, PTA Secretary">
                                <div class="leader-info">
                                    <h4>Emily White</h4>
                                    <p class="mb-2">Secretary</p>
                                    <p class="text-sm leading-tight">Emily's background in communications and event planning has revolutionized our parent engagement strategies. She established our monthly newsletter and digital outreach program.</p>
                                </div>
                            </div>
                            <div class="leader-card reveal" style="transition-delay: 300ms;">
                                <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&q=80&w=400&h=500" alt="Portrait of Michael Brown, PTA Treasurer">
                                <div class="leader-info">
                                    <h4>Michael Brown</h4>
                                    <p class="mb-2">Treasurer</p>
                                    <p class="text-sm leading-tight">As a certified public accountant, Michael ensures transparent financial management and has implemented digital payment solutions that increased our fundraising efficiency by 40%.</p>
                                </div>
                            </div>
                            <div class="leader-card reveal" style="transition-delay: 400ms;">
                                <img src="https://images.unsplash.com/photo-1587614382346-4ec70e388b28?auto=format&fit=crop&q=80&w=400&h=500" alt="Portrait of Sarah Chen, Fundraising Chair">
                                <div class="leader-info">
                                    <h4>Sarah Chen</h4>
                                    <p class="mb-2">Fundraising Chair</p>
                                    <p class="text-sm leading-tight">Sarah's innovative approach to fundraising has introduced successful events like our annual Tech Fair and Cultural Festival, raising over $50,000 for school programs annually.</p>
                                </div>
                            </div>
                            <div class="leader-card reveal" style="transition-delay: 500ms;">
                                <img src="https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&q=80&w=400&h=500" alt="Portrait of David Rodriguez, Volunteer Coordinator">
                                <div class="leader-info">
                                    <h4>David Rodriguez</h4>
                                    <p class="mb-2">Volunteer Coordinator</p>
                                    <p class="text-sm leading-tight">David manages our extensive volunteer network and has developed a streamlined digital system for matching volunteers with opportunities, increasing participation by 60%.</p>
                                </div>
                            </div>
                            <div class="leader-card reveal" style="transition-delay: 600ms;">
                                <img src="https://images.unsplash.com/photo-1594744803329-e58b31de8bf5?auto=format&fit=crop&q=80&w=400&h=500" alt="Portrait of Rachel Kim, Programs Director">
                                <div class="leader-info">
                                    <h4>Rachel Kim</h4>
                                    <p class="mb-2">Programs Director</p>
                                    <p class="text-sm leading-tight">With a background in curriculum development, Rachel oversees our after-school enrichment programs and has introduced popular STEAM workshops and language clubs.</p>
                                </div>
                            </div>
                            <div class="leader-card reveal" style="transition-delay: 700ms;">
                                <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&q=80&w=400&h=500" alt="Portrait of Lisa Martinez, Communications Chair">
                                <div class="leader-info">
                                    <h4>Lisa Martinez</h4>
                                    <p class="mb-2">Communications Chair</p>
                                    <p class="text-sm leading-tight">Lisa leads our social media presence and community outreach efforts, ensuring families stay informed and connected through multiple communication channels.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="angled-section reveal" aria-labelledby="community-action-heading">
                    <div class="container mx-auto px-6">
                        <h2 id="community-action-heading" class="heading-font text-4xl text-brand-navy mb-12 text-center">Our Community in Action</h2>
                        <div class="photo-collage grid grid-cols-2 md:grid-cols-4 gap-4">
                           <div class="image-container shadow-md">
                               <img src="https://images.unsplash.com/photo-1559027615-cd4628902d4a?auto=format&fit=crop&q=80&w=600&h=400" alt="Volunteers at the PTA bake sale" class="w-full h-full object-cover">
                               <div class="image-overlay">
                                   <h4 class="font-bold mb-1">PTA Bake Sale</h4>
                                   <p class="text-sm">Our popular bake sales bring the community together while raising funds for school programs and activities.</p>
                               </div>
                           </div>
                           <div class="image-container shadow-md row-span-2">
                               <img src="https://images.unsplash.com/photo-1543364195-077a16c30ff3?auto=format&fit=crop&q=80&w=600&h=800" alt="Family enjoying the fall festival" class="w-full h-full object-cover">
                               <div class="image-overlay">
                                   <h4 class="font-bold mb-1">Fall Festival Fun</h4>
                                   <p class="text-sm">Our annual Fall Festival brings families together for a day of games, activities, and community building.</p>
                               </div>
                           </div>
                           <div class="image-container shadow-md">
                               <img src="https://images.unsplash.com/photo-1583468982228-19f19164aee2?auto=format&fit=crop&q=80&w=600&h=400" alt="Students at the book fair" class="w-full h-full object-cover">
                               <div class="image-overlay">
                                   <h4 class="font-bold mb-1">Book Fair Adventures</h4>
                                   <p class="text-sm">The Scholastic Book Fair promotes literacy while helping our library grow with new selections.</p>
                               </div>
                           </div>
                           <div class="image-container shadow-md">
                               <img src="https://images.unsplash.com/photo-1606761568499-6d2451b23c66?auto=format&fit=crop&q=80&w=600&h=400" alt="Teacher appreciation luncheon" class="w-full h-full object-cover">
                               <div class="image-overlay">
                                   <h4 class="font-bold mb-1">Teacher Appreciation</h4>
                                   <p class="text-sm">We celebrate our dedicated teachers with special events throughout the year to show our gratitude.</p>
                               </div>
                           </div>
                           <div class="image-container shadow-md">
                               <img src="https://images.unsplash.com/photo-1517486808906-6ca8b3f04846?auto=format&fit=crop&q=80&w=600&h=400" alt="Parents at a PTA meeting" class="w-full h-full object-cover">
                               <div class="image-overlay">
                                   <h4 class="font-bold mb-1">PTA Meetings</h4>
                                   <p class="text-sm">Monthly meetings where parents and teachers collaborate to enhance our school community.</p>
                               </div>
                           </div>
                           <div class="image-container shadow-md">
                               <img src="https://images.unsplash.com/photo-1516979187457-637abb4f9353?auto=format&fit=crop&q=80&w=600&h=400" alt="Parent volunteers helping in a classroom" class="w-full h-full object-cover">
                               <div class="image-overlay">
                                   <h4 class="font-bold mb-1">Classroom Volunteers</h4>
                                   <p class="text-sm">Parent volunteers enrich our classrooms by supporting teachers and engaging with students.</p>
                               </div>
                           </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Member Portal Page -->
        <div id="portal-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="portal-heading">
            <h1 id="portal-heading" class="heading-font text-4xl text-brand-navy text-center reveal sticky-title">Member Portal</h1>
            <div class="pt-8">
                <section class="mb-16" aria-labelledby="membership-status-heading">
                     <h2 id="membership-status-heading" class="heading-font text-3xl text-brand-navy mb-8 text-center">Membership Status</h2>
                     <div id="membership-status-container" class="bento-item max-w-2xl mx-auto text-center">
                         <p>Loading membership status...</p>
                         <!-- Status and Join/Renew button will appear here -->
                     </div>
                 </section>

                <section id="portal-announcements-section" class="mb-16" aria-labelledby="portal-announcements-heading"> <!-- Added ID -->
                    <h2 id="portal-announcements-heading" class="heading-font text-3xl text-brand-navy mb-8 text-center">PTA Announcements</h2>
                    <div id="portal-announcements-grid" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Announcements will be loaded here -->
                    </div>
                </section>

                <section id="portal-minutes-section" class="mb-16" aria-labelledby="portal-minutes-heading"> <!-- Added ID -->
                    <h2 id="portal-minutes-heading" class="heading-font text-3xl text-brand-navy mb-8 text-center">Meeting Minutes</h2>
                    <div id="portal-minutes-container" class="bento-item max-w-2xl mx-auto">
                         <!-- Meeting minutes will be loaded here -->
                    </div>
                </section>

                <section id="volunteer-dashboard-section" class="mb-16" aria-labelledby="volunteer-dashboard-heading"> <!-- Added ID -->
                    <h2 id="volunteer-dashboard-heading" class="heading-font text-3xl text-brand-navy mb-8 text-center">Volunteer Dashboard</h2>
                    <div id="volunteer-events-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <p>Loading volunteer opportunities...</p>
                    </div>
                </section>
            </div>
        </div>

        <!-- Membership Purchase Page -->
        <div id="membership-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="membership-heading">
            <h1 id="membership-heading" class="heading-font text-4xl text-brand-navy text-center reveal sticky-title">Join or Renew Membership</h1>
            <div class="pt-8 max-w-4xl mx-auto">
                
                <!-- "Why Join?" Section - ALWAYS VISIBLE -->
                <section class="mb-12 bento-item" aria-labelledby="why-join-heading">
                    <h2 id="why-join-heading" class="heading-font text-3xl text-brand-navy mb-6 text-center">Why Join the PTA?</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                        <div>
                            <i class="fas fa-users text-4xl text-brand-red mb-4"></i>
                            <h3 class="font-bold text-lg text-brand-navy mb-2">Access Exclusive Content</h3>
                            <p>View member-only announcements, meeting minutes, and (in the future) the school directory.</p>
                        </div>
                        <div>
                            <i class="fas fa-hands-helping text-4xl text-brand-red mb-4"></i>
                            <h3 class="font-bold text-lg text-brand-navy mb-2">Get Involved</h3>
                            <p>Get access to the Volunteer Dashboard to easily sign up for opportunities.</p>
                        </div>
                        <div>
                            <i class="fas fa-school text-4xl text-brand-red mb-4"></i>
                            <h3 class="font-bold text-lg text-brand-navy mb-2">Support Your School</h3>
                            <p>Your dues directly fund teacher grants, student programs, and community events.</p>
                        </div>
                    </div>
                </section>

                <!-- Membership Tiers Section - ALWAYS VISIBLE -->
                <section class="mb-12" aria-labelledby="tiers-heading">
                    <h2 id="tiers-heading" class="heading-font text-3xl text-brand-navy mb-6">Select Membership Level</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <!-- Family Membership Option -->
                        <div>
                             <input type="radio" name="membershipLevel" value="Family" id="level-family" class="sr-only" checked>
                             <label for="level-family" class="block border-2 border-gray-300 rounded-lg p-6 cursor-pointer transition hover:border-brand-red">
                                 <h3 class="font-bold text-xl text-brand-navy mb-2">Family Membership</h3>
                                 <p class="text-3xl font-bold text-brand-navy mb-2">$50<span class="text-lg font-normal"> / year</span></p>
                                 <p class="text-sm">Includes membership for all parents/guardians in the household.</p>
                             </label>
                         </div>
                        <!-- Teacher Membership Option -->
                         <div>
                             <input type="radio" name="membershipLevel" value="Teacher" id="level-teacher" class="sr-only">
                             <label for="level-teacher" class="block border-2 border-gray-300 rounded-lg p-6 cursor-pointer transition hover:border-brand-red">
                                 <h3 class="font-bold text-xl text-brand-navy mb-2">Teacher/Staff Membership</h3>
                                 <p class="text-3xl font-bold text-brand-navy mb-2">$25<span class="text-lg font-normal"> / year</span></p>
                                 <p class="text-sm">Special rate for our dedicated Frazer School faculty and staff.</p>
                             </label>
                         </div>
                    </div>
                </section>


                <!-- This section will show a "Login to Join" button *if* user is logged out -->
                <div id="login-to-join-section" class="hidden text-center bento-item">
                    <h2 class="heading-font text-3xl text-brand-navy mb-6">Purchase Your Membership</h2>
                    <p class="text-lg mb-8">Please log in or create an account to purchase or renew your membership. Email verification is required.</p>
                    <button id="join-now-login-button" class="btn btn-primary btn-lg">Log In or Sign Up to Join</button>
                </div>

                <!-- This section will show payment options *if* user is logged in -->
                <div id="payment-section" class="hidden">
                    <h2 class="heading-font text-3xl text-brand-navy mb-6">Payment Options</h2>
                    <div class="bento-item grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <!-- Option 1: Pay Online Button -->
                        <div class="text-center md:text-left">
                            <h3 class="text-xl font-semibold text-brand-navy mb-2">Pay Online via Stax</h3>
                            <p class="mb-4">Click the button below to complete your payment securely through Stax. A 2% convenience fee will be added for online payments.</p>
                            <a href="YOUR_STAX_PAYMENT_LINK_HERE" target="_blank" class="btn btn-primary">Pay Online Now</a>
                            <p class="text-xs text-gray-500 mt-2">(You will be redirected to Stax)</p>
                        </div>
                        <!-- Option 2: Scan QR Code -->
                        <div class="text-center">
                             <h3 class="text-xl font-semibold text-brand-navy mb-2">Scan to Pay</h3>
                             <p class="mb-4">Use your phone camera to scan the QR code below to pay via Stax. A 2% convenience fee will be added.</p>
                             <img src="https://images.unsplash.com/photo-1556740749-887f6717d7e4?auto=format&fit=crop&q=80&w=200&h=200" alt="Stax QR Code for Payment" class="mx-auto border rounded-lg p-2 bg-white">
                             <p class="text-xs text-gray-500 mt-2">(Opens Stax payment page on your phone)</p>
                        </div>
                    </div>
                     <p class="text-center mt-8 text-gray-600">After completing your payment, please allow up to 24 hours for your membership status to update in the portal.</p>
                     <p id="membership-error" class="text-red-500 text-center mt-4"></p>
                </div>
                
                <!-- FAQ Section - ALWAYS VISIBLE -->
                <section class="mt-16" aria-labelledby="faq-heading">
                    <h2 id="faq-heading" class="heading-font text-3xl text-brand-navy mb-6 text-center">Frequently Asked Questions</h2>
                    <div class="space-y-2 max-w-2xl mx-auto">
                        <details>
                            <summary>How long does my membership last?</summary>
                            <div>
                                <p>Your membership is valid for one full year from the date of purchase. We'll send you a reminder email when it's time to renew!</p>
                            </div>
                        </details>
                        <details>
                            <summary>What is the 2% convenience fee?</summary>
                            <div>
                                <p>The 2% fee covers the credit card processing charges from our payment provider (Stax). This ensures that 100% of your membership dues go directly to funding PTA programs, teacher grants, and school events.</p>
                            </div>
                        </details>
                        <details>
                            <summary>Why do I need to create an account?</summary>
                            <div>
                                <p>Creating an account allows us to verify your email, link your membership to your household, and give you secure access to the private Member Portal, which includes the Volunteer Dashboard and member-only announcements.</p>
                            </div>
                        </details>
                        <details>
                            <summary>Is my payment secure?</summary>
                            <div>
                                <p>Yes. All payments are processed securely by Stax, a PCI-compliant payment provider. Your credit card information is never stored on our website.</p>
                            </div>
                        </details>
                    </div>
                </section>

            </div>
        </div>

        <!-- Store Page -->
        <div id="store-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="store-heading">
            <h1 id="store-heading" class="heading-font text-4xl text-brand-navy text-center reveal sticky-title">School Store</h1>
            <div class="pt-8">
                <p class="text-lg text-center max-w-3xl mx-auto mb-12">Show your school spirit! All proceeds from the store directly support our PTA programs, teacher grants, and student events.</p>
                
                <div id="product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Mock Product 1: T-Shirt -->
                    <div class="bento-item flex flex-col">
                        <img src="https://images.unsplash.com/photo-1541099649105-f69ad21f3246?auto=format&fit=crop&q=80&w=600&h=400" alt="School T-Shirt" class="rounded-lg mb-4 w-full object-cover aspect-video">
                        <h3 class="heading-font text-2xl text-brand-navy mb-2">Frazer School T-Shirt</h3>
                        <p class="text-2xl font-bold text-brand-navy mb-4">$20.00</p>
                        <div class="mb-4">
                            <label for="size-shirt" class="block text-sm font-medium text-brand-navy mb-1">Size</label>
                            <select id="size-shirt" name="size-shirt" class="w-full p-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-brand-red">
                                <option>Small</option>
                                <option>Medium</option>
                                <option>Large</option>
                                <option>X-Large</option>
                            </select>
                        </div>
                        <button class="btn btn-primary mt-auto">Add to Cart</button>
                    </div>

                    <!-- Mock Product 2: Coffee Mug -->
                    <div class="bento-item flex flex-col">
                        <img src="https://images.unsplash.com/photo-1517685352821-92cf88aee5a5?auto=format&fit=crop&q=80&w=600&h=400" alt="School Coffee Mug" class="rounded-lg mb-4 w-full object-cover aspect-video">
                        <h3 class="heading-font text-2xl text-brand-navy mb-2">Frazer Coffee Mug</h3>
                        <p class="text-2xl font-bold text-brand-navy mb-4">$15.00</p>
                        <div class="mb-4">
                            <label for="size-mug" class="block text-sm font-medium text-brand-navy mb-1">Style</label>
                            <select id="size-mug" name="size-mug" class="w-full p-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-brand-red" disabled>
                                <option>11 oz. Ceramic</option>
                            </select>
                        </div>
                        <button class="btn btn-primary mt-auto">Add to Cart</button>
                    </div>

                    <!-- Mock Product 3: Hat -->
                    <div class="bento-item flex flex-col">
                        <img src="https://images.unsplash.com/photo-1519744792095-2f2205e87b6f?auto=format&fit=crop&q=80&w=600&h=400" alt="School Hat" class="rounded-lg mb-4 w-full object-cover aspect-video">
                        <h3 class="heading-font text-2xl text-brand-navy mb-2">Frazer Baseball Cap</h3>
                        <p class="text-2xl font-bold text-brand-navy mb-4">$18.00</p>
                        <div class="mb-4">
                            <label for="size-hat" class="block text-sm font-medium text-brand-navy mb-1">Size</label>
                            <select id="size-hat" name="size-hat" class="w-full p-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-brand-red" disabled>
                                <option>One Size (Adjustable)</option>
                            </select>
                        </div>
                        <button class="btn btn-primary mt-auto">Add to Cart</button>
                    </div>

                </div>
            </div>
        </div>

        <!-- NEW: Donation Page -->
        <div id="donation-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="donation-heading">
            <h1 id="donation-heading" class="heading-font text-4xl text-brand-navy text-center reveal sticky-title">Support Our School</h1>
            <div class="pt-8 max-w-4xl mx-auto">
                <p class="text-lg text-center mb-12">Your generous donation directly funds teacher grants, student programs, and community-building events that enrich the lives of every student at The Frazer School. Thank you for your support!</p>

                <form id="donation-form" class="bento-item">
                    <h2 class="heading-font text-3xl text-brand-navy mb-6 text-center">Make a Donation</h2>
                    
                    <!-- Donation Type -->
                    <div class="flex justify-center mb-6">
                        <input type="radio" name="donationType" value="one-time" id="one-time-donation" class="sr-only" checked>
                        <label for="one-time-donation" class="block border-2 border-gray-300 rounded-l-lg p-4 cursor-pointer transition text-center w-1/2">
                            <span class="font-bold text-lg text-brand-navy">One-Time</span>
                        </label>
                        
                        <input type="radio" name="donationType" value="recurring" id="recurring-donation" class="sr-only">
                        <label for="recurring-donation" class="block border-2 border-gray-300 rounded-r-lg p-4 cursor-pointer transition text-center w-1/2 border-l-0">
                            <span class="font-bold text-lg text-brand-navy">Monthly</span>
                        </label>
                    </div>

                    <!-- Donation Amounts -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <input type="radio" name="donationAmount" value="25" id="amount-25" class="sr-only">
                        <label for="amount-25" class="block border-2 border-gray-300 rounded-lg p-4 cursor-pointer transition text-center font-bold text-xl text-brand-navy hover:border-brand-red">$25</label>

                        <input type="radio" name="donationAmount" value="50" id="amount-50" class="sr-only" checked>
                        <label for="amount-50" class="block border-2 border-gray-300 rounded-lg p-4 cursor-pointer transition text-center font-bold text-xl text-brand-navy hover:border-brand-red">$50</label>

                        <input type="radio" name="donationAmount" value="100" id="amount-100" class="sr-only">
                        <label for="amount-100" class="block border-2 border-gray-300 rounded-lg p-4 cursor-pointer transition text-center font-bold text-xl text-brand-navy hover:border-brand-red">$100</label>

                        <input type="radio" name="donationAmount" value="other" id="amount-other" class="sr-only">
                        <label for="amount-other" class="block border-2 border-gray-300 rounded-lg p-4 cursor-pointer transition text-center font-bold text-xl text-brand-navy hover:border-brand-red">Other</label>
                    </div>

                    <!-- Custom Amount Input -->
                    <div id="custom-amount-container" class="hidden mb-6">
                        <label for="custom-amount" class="block text-brand-navy font-bold mb-2">Custom Amount ($)</label>
                        <input type="number" id="custom-amount" name="customAmount" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-red" min="1" placeholder="5.00">
                    </div>

                    <!-- Anonymous Checkbox -->
                    <div class="flex items-center justify-center mb-8">
                        <input type="checkbox" id="anonymous-donation" name="anonymous" class="h-5 w-5 text-brand-red rounded border-gray-300 focus:ring-brand-red">
                        <label for="anonymous-donation" class="ml-3 text-lg text-brand-navy">Make my donation anonymous</label>
                    </div>
                    
                    <!-- Payment Section -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="text-center md:text-left">
                            <h3 class="text-xl font-semibold text-brand-navy mb-2">Pay Online via Stax</h3>
                            <p class="mb-4">Click to complete your donation securely. A 2% convenience fee will be added.</p>
                            <a href="YOUR_STAX_DONATION_LINK_HERE" target="_blank" class="btn btn-primary">Donate Now</a>
                            <p class="text-xs text-gray-500 mt-2">(You will be redirected to Stax)</p>
                        </div>
                        <div class="text-center">
                             <h3 class="text-xl font-semibold text-brand-navy mb-2">Scan to Donate</h3>
                             <p class="mb-4">Use your phone camera to scan the QR code below. A 2% convenience fee will be added.</p>
                             <img src="https://images.unsplash.com/photo-1556740749-887f6717d7e4?auto=format&fit=crop&q=80&w=200&h=200" alt="Stax QR Code for Donations" class="mx-auto border rounded-lg p-2 bg-white">
                        </div>
                    </div>
                    <p id="donation-message" class="text-green-600 text-center mt-4"></p>

                </form>
            </div>
        </div>

        <!-- NEW: Donor Wall Page (Mockup) -->
        <div id="donor-wall-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="donor-wall-heading">
            <h1 id="donor-wall-heading" class="heading-font text-4xl text-brand-navy text-center reveal sticky-title">Thank You, Supporters!</h1>
            <div class="pt-8 max-w-4xl mx-auto">
                <p class="text-lg text-center mb-12">We are incredibly grateful for the generous support of our community. Your contributions make a direct impact on our students, teachers, and school.
                </p>

                <!-- Mockup Donor Tiers -->
                <section class="mb-12">
                    <h2 class="heading-font text-3xl text-brand-red mb-6 border-b-2 border-brand-red pb-2">Star Supporters ($500+)</h2>
                    <ul class="list-disc list-inside space-y-2 text-lg">
                        <li>The Johnson Family</li>
                        <li>A Friend of Frazer</li>
                        <li>Smith & Co.</li>
                    </ul>
                </section>

                <section class="mb-12">
                    <h2 class="heading-font text-3xl text-brand-navy mb-6 border-b-2 border-brand-navy pb-2">Hub Champions ($100 - $499)</h2>
                    <ul class="list-disc list-inside space-y-2 text-lg">
                        <li>Jane D.</li>
                        <li>The Patel Family</li>
                        <li>Mr. Michael Brown</li>
                        <li>Anonymous</li>
                        <li>Garcia's Grill</li>
                        <li>Anonymous</li>
                    </ul>
                </section>
                
                <section class="mb-12">
                    <h2 class="heading-font text-3xl text-brand-grey mb-6 border-b-2 border-brand-grey pb-2">Community Friends (Up to $99)</h2>
                    <ul class="list-disc list-inside space-y-2 text-lg">
                        <li>Emily W.</li>
                        <li>Anonymous</li>
                        <li>The Lee Family</li>
                        <li>David C.</li>
                        <li>And many more anonymous supporters!</li>
                    </ul>
                </section>
            </div>
        </div>
        
        <!-- NEW: Raffle Page -->
        <div id="raffle-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="raffle-heading">
            <h1 id="raffle-heading" class="heading-font text-4xl text-brand-navy text-center reveal sticky-title">Annual PTA Raffle</h1>
            <div class="pt-8 max-w-4xl mx-auto">
                <p class="text-lg text-center mb-12">Win big and support our school! All proceeds from the raffle go directly to funding new technology for our classrooms and supporting our amazing teachers.</p>

                <!-- Prize Section -->
                <section class="mb-12 bento-item" aria-labelledby="prizes-heading">
                    <h2 id="prizes-heading" class="heading-font text-3xl text-brand-navy mb-6 text-center">Grand Prizes</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-center">
                        <div>
                            <img src="https://images.unsplash.com/photo-1566073771259-6a8506099945?auto=format&fit=crop&q=80&w=600&h=400" alt="Grand Prize 1" class="rounded-lg mb-4 w-full object-cover aspect-video">
                            <h3 class="font-bold text-xl text-brand-navy mb-2">Weekend Getaway</h3>
                            <p>A 2-night stay at a luxury downtown hotel.</p>
                        </div>
                        <div>
                            <img src="https://images.unsplash.com/photo-1593642702749-b7d2a804fbcf?auto=format&fit=crop&q=80&w=600&h=400" alt="Grand Prize 2" class="rounded-lg mb-4 w-full object-cover aspect-video">
                            <h3 class="font-bold text-xl text-brand-navy mb-2">Tech Bundle</h3>
                            <p>A brand new tablet and smart speaker.</p>
                        </div>
                    </div>
                </section>

                <!-- Ticket Purchase Tiers -->
                <section class="mb-12" aria-labelledby="tickets-heading">
                    <h2 id="tickets-heading" class="heading-font text-3xl text-brand-navy mb-6 text-center">Get Your Tickets</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div>
                             <input type="radio" name="raffleTier" value="1" id="tier-1" class="sr-only" checked>
                             <label for="tier-1" class="block border-2 border-gray-300 rounded-lg p-6 cursor-pointer transition hover:border-brand-red text-center">
                                 <h3 class="font-bold text-xl text-brand-navy mb-1">1 Ticket</h3>
                                 <p class="text-3xl font-bold text-brand-navy">$5</p>
                             </label>
                         </div>
                         <div>
                             <input type="radio" name="raffleTier" value="5" id="tier-5" class="sr-only">
                             <label for="tier-5" class="block border-2 border-gray-300 rounded-lg p-6 cursor-pointer transition hover:border-brand-red text-center">
                                 <h3 class="font-bold text-xl text-brand-navy mb-1">5 Tickets</h3>
                                 <p class="text-3xl font-bold text-brand-navy">$20</p>
                                 <p class="text-sm font-semibold text-brand-red">(Save $5!)</p>
                             </label>
                         </div>
                         <div>
                             <input type="radio" name="raffleTier" value="15" id="tier-15" class="sr-only">
                             <label for="tier-15" class="block border-2 border-gray-300 rounded-lg p-6 cursor-pointer transition hover:border-brand-red text-center">
                                 <h3 class="font-bold text-xl text-brand-navy mb-1">15 Tickets</h3>
                                 <p class="text-3xl font-bold text-brand-navy">$50</p>
                                 <p class="text-sm font-semibold text-brand-red">(Best Value!)</p>
                             </label>
                         </div>
                    </div>
                </section>


                <!-- Login to Participate Button -->
                <div id="login-to-participate-section" class="hidden text-center bento-item">
                    <h2 class="heading-font text-3xl text-brand-navy mb-6">Participate in the Raffle</h2>
                    <p class="text-lg mb-8">Please log in or create an account to purchase tickets and participate in our referral program. Email verification is required.</p>
                    <button id="raffle-login-button" class="btn btn-primary btn-lg">Log In or Sign Up to Participate</button>
                </div>

                <!-- Payment Options (Visible if logged in) -->
                <div id="raffle-payment-section" class="hidden">
                    <h2 class="heading-font text-3xl text-brand-navy mb-6">Purchase Your Tickets</h2>
                    <div class="bento-item grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <!-- Option 1: Pay Online Button -->
                        <div class="text-center md:text-left">
                            <h3 class="text-xl font-semibold text-brand-navy mb-2">Pay Online via Stax</h3>
                            <p class="mb-4">Click the button below to complete your purchase securely. A 2% convenience fee will be added.</p>
                            <a href="YOUR_STAX_RAFFLE_LINK_HERE" target="_blank" class="btn btn-primary">Purchase Now</a>
                            <p class="text-xs text-gray-500 mt-2">(You will be redirected to Stax)</p>
                        </div>
                        <!-- Option 2: Scan QR Code -->
                        <div class="text-center">
                             <h3 class="text-xl font-semibold text-brand-navy mb-2">Scan to Pay</h3>
                             <p class="mb-4">Use your phone camera to scan the QR code below. A 2% convenience fee will be added.</p>
                             <img src="https://images.unsplash.com/photo-1556740749-887f6717d7e4?auto=format&fit=crop&q=80&w=200&h=200" alt="Stax QR Code for Raffle" class="mx-auto border rounded-lg p-2 bg-white">
                        </div>
                    </div>
                     <p class="text-center mt-8 text-gray-600">Your ticket numbers will be automatically assigned and emailed to you upon payment confirmation.</p>
                </div>
                
                <!-- Referral Leaderboard Link -->
                <section class="mt-16 text-center" aria-labelledby="referral-heading">
                    <h2 id="referral-heading" class="heading-font text-3xl text-brand-navy mb-6">Refer Friends & Earn Bonus Entries!</h2>
                    <p class="text-lg mb-8 max-w-2xl mx-auto">Share your unique referral link with friends and family. For every ticket they buy, you'll earn a bonus entry! See who's on top.</p>
                    <a href="#" class="btn btn-secondary" data-page="raffle-leaderboard" role="button">View Referral Leaderboard</a>
                </section>

            </div>
        </div>

        <!-- NEW: Raffle Leaderboard Page (Mockup) -->
        <div id="raffle-leaderboard-page" class="hidden page container mx-auto px-6 pb-12" aria-labelledby="leaderboard-heading">
            <h1 id="leaderboard-heading" class="heading-font text-4xl text-brand-navy text-center reveal sticky-title">Raffle Referral Leaderboard</h1>
            <div class="pt-8 max-w-4xl mx-auto">
                <div class="bento-item mb-12">
                    <h2 class="heading-font text-3xl text-brand-navy mb-4 text-center">Share Your Link!</h2>
                    <p class="text-lg text-center mb-4">Log in to get your unique referral link. Share it to earn bonus entries for every ticket purchased through your link!</p>
                    <!-- This would be shown conditionally if user is logged in -->
                    <div id="referral-link-container" class="text-center hidden">
                        <label for="referral-link" class="block font-bold text-brand-navy mb-2">Your Unique Link</label>
                        <input type="text" id="referral-link" class="w-full max-w-md p-3 border border-gray-300 rounded-lg text-center text-gray-500" value="https://frazerhub.com/raffle?ref=USER123" readonly>
                        <button id="copy-referral-link" class="btn btn-primary mt-4">Copy Link</button>
                    </div>
                    <!-- This would be shown if user is logged out -->
                    <div id="login-for-referral-link" class="text-center">
                        <button class="btn btn-primary" id="leaderboard-login-button">Log In to Get Your Link</button>
                    </div>
                </div>

                <!-- Mockup Leaderboard Tiers -->
                <section>
                    <h2 class="heading-font text-3xl text-brand-navy mb-6 text-center">Top Referrers</h2>
                    <ol class="list-decimal list-inside space-y-4 text-lg bento-item">
                        <li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-bold text-xl"><i class="fas fa-trophy text-yellow-400 mr-2"></i> 1. The Johnson Family</span>
                            <span class="font-bold text-brand-red">25 Referrals</span>
                        </li>
                        <li class="flex justify-between items-center p-3">
                            <span class="font-bold text-xl"><i class="fas fa-medal text-gray-400 mr-2"></i> 2. Jane D.</span>
                            <span class="font-bold text-brand-red">18 Referrals</span>
                        </li>
                        <li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-bold text-xl"><i class="fas fa-award text-yellow-600 mr-2"></i> 3. The Patel Family</span>
                            <span class="font-bold text-brand-red">12 Referrals</span>
                        </li>
                        <li class="flex justify-between items-center p-3">
                            <span class="text-lg">4. Mr. Michael Brown</span>
                            <span class="text-brand-navy">10 Referrals</span>
                        </li>
                        <li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="text-lg">5. David C.</span>
                            <span class="text-brand-navy">7 Referrals</span>
                        </li>
                    </ol>
                </section>
            </div>
        </div>


    </main>

    <footer class="bg-brand-navy text-white/80 mt-16" aria-labelledby="footer-heading">
        <h2 id="footer-heading" class="sr-only">Footer</h2>
        <div class="container mx-auto px-6 py-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
                <div>
                    <h3 class="heading-font text-xl text-white mb-4">The Frazer School Hub</h3>
                    <p class="text-gray-400">A dynamic community where student ambition and parent partnership create extraordinary outcomes.</p>
                </div>
                <div>
                    <h3 class="heading-font text-xl text-white mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="#" data-page="home" class="hover:text-white transition-colors" role="button">Home</a></li>
                        <li><a href="#" data-page="teams" class="hover:text-white transition-colors" role="button">Teams</a></li>
                        <li><a href="#" data-page="clubs" class="hover:text-white transition-colors" role="button">Clubs</a></li>
                        <li><a href="#" data-page="upcoming" class="hover:text-white transition-colors" role="button">Events</a></li>
                        <li><a href="#" data-page="pta" class="hover:text-white transition-colors" role="button">PTA</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="heading-font text-xl text-white mb-4">Connect With Us</h3>
                    <div class="flex justify-center md:justify-start space-x-4">
                        <a href="#" class="hover:text-white transition-colors" aria-label="Frazer School on Facebook"><i class="fab fa-facebook-f text-2xl"></i></a>
                        <a href="#" class="hover:text-white transition-colors" aria-label="Frazer School on Twitter"><i class="fab fa-twitter text-2xl"></i></a>
                        <a href="mailto:contact@frazerschoolpta.org" class="hover:text-white transition-colors" aria-label="Email the Frazer School PTA"><i class="fas fa-envelope text-2xl"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-500">
                 <p>&copy; <span id="year"></span> The Frazer School Hub. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <a href="#" id="back-to-top" class="w-12 h-12 bg-brand-red text-white rounded-full flex items-center justify-center shadow-lg hover:bg-red-700 transition-all" aria-label="Back to top">
        <i class="fas fa-arrow-up"></i>
    </a>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
        import {
            getAuth,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            sendEmailVerification,
            sendPasswordResetEmail,
            signOut,
            onAuthStateChanged,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import {
            getFirestore,
            collection,
            doc,
            setDoc,
            getDoc,
            updateDoc,
            onSnapshot,
            serverTimestamp
        } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";


        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyBiGwJ6BcjMaPvznaJDdqFRlovYiOieZnk",
          authDomain: "tfspta-83d67.firebaseapp.com",
          projectId: "tfspta-83d67",
          storageBucket: "tfspta-83d67.appspot.com",
          messagingSenderId: "691850123101",
          appId: "1:691850123101:web:f3cc8801ba6d8223487ab4",
          measurementId: "G-YXQ4Y6L3R6"
        };


        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const analytics = getAnalytics(app);

        // Expose necessary Firebase functions/objects globally for non-module script
        window.firebase = { auth, db, doc, getDoc, updateDoc, setDoc, serverTimestamp, signOut };
        // Dispatch a custom event to signal Firebase is ready for the non-module script
        window.dispatchEvent(new CustomEvent('firebaseReady', { detail: { auth, db, doc, getDoc, updateDoc, setDoc, serverTimestamp, signOut } }));
        console.log("Firebase Initialized in module script.");


        // --- AUTH UI ELEMENTS ---
        const authOverlay = document.getElementById('auth-overlay');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const portalLink = document.getElementById('portal-link');
        const mobileLoginButton = document.getElementById('mobile-login-button');
        const mobileLogoutButton = document.getElementById('mobile-logout-button');
        const mobilePortalLink = document.getElementById('mobile-portal-link');
        const membershipStatusContainer = document.getElementById('membership-status-container');
        const authMessage = document.getElementById('auth-message');
        const forgotPasswordContainer = document.getElementById('forgot-password-container');
        const loginContainer = document.getElementById('login-container');
        const signupContainer = document.getElementById('signup-container');
        // Links to toggle auth forms
        const showSignup = document.getElementById('show-signup');
        const showLogin = document.getElementById('show-login');
        const forgotPasswordLink = document.getElementById('forgot-password-link');
        const backToLoginLink = document.getElementById('back-to-login');
        const closeAuthButton = document.getElementById('close-auth-button');
        const joinNowLoginButton = document.getElementById('join-now-login-button');
        // Membership Page sections
        const paymentSection = document.getElementById('payment-section');
        const loginToJoinSection = document.getElementById('login-to-join-section');
        // Donation Page elements
        const customAmountContainer = document.getElementById('custom-amount-container');
        const donationForm = document.getElementById('donation-form');
        // Raffle Page elements
        const rafflePaymentSection = document.getElementById('raffle-payment-section');
        const loginToParticipateSection = document.getElementById('login-to-participate-section');
        const raffleLoginButton = document.getElementById('raffle-login-button');
        const leaderboardLoginButton = document.getElementById('leaderboard-login-button');
        const referralLinkContainer = document.getElementById('referral-link-container');
        const loginForReferralLink = document.getElementById('login-for-referral-link');
        const copyReferralLinkButton = document.getElementById('copy-referral-link');
        const referralLinkInput = document.getElementById('referral-link');
        // Portal Content Sections
        const portalAnnouncements = document.getElementById('portal-announcements-section');
        const portalMinutes = document.getElementById('portal-minutes-section');
        const volunteerDashboard = document.getElementById('volunteer-dashboard-section');


        // --- AUTH STATE LISTENER ---
        let unsubscribeUser = null;
        onAuthStateChanged(auth, async user => {
             if (unsubscribeUser) { unsubscribeUser(); unsubscribeUser = null; }

            if (user) {
                // User is signed in
                loginButton.classList.add('hidden'); mobileLoginButton.classList.add('hidden');
                portalLink.classList.remove('hidden'); portalLink.textContent = user.displayName ? `Welcome, ${user.displayName.split(' ')[0]}!` : 'Member Portal';
                logoutButton.classList.remove('hidden'); mobilePortalLink.classList.remove('hidden'); mobileLogoutButton.classList.remove('hidden');

                if (!user.emailVerified) {
                    console.log(`User ${user.uid} is signed in but email not verified.`);
                    clearPortalData(); // Clear portal data for unverified user
                } else {
                    console.log('User logged in and verified:', user.uid, user.displayName);
                    // Firestore listener will handle loading data
                }

                // Check Firestore for membership status
                const userDocRef = doc(db, "users", user.uid);
                unsubscribeUser = onSnapshot(userDocRef, (userDocSnap) => {
                    let isMember = false; let expiryDate = null;
                    if (userDocSnap.exists()) {
                        const userData = userDocSnap.data();
                        isMember = userData.isMember || false;
                        expiryDate = userData.membershipExpiry ? userData.membershipExpiry.toDate() : null;
                        console.log("Real-time Membership Status:", isMember, "Expires:", expiryDate);
                        
                        updateMembershipStatusUI(isMember, expiryDate); // Update portal status block
                        
                        // NEW LOGIC: Control portal content visibility
                        if (user.emailVerified) {
                             // User is verified, show volunteer dashboard regardless of membership
                             loadPortalData(user, isMember, expiryDate);
                        } else {
                             // User not verified
                             clearPortalData();
                        }
                    } else {
                        console.log("User document not found. Creating basic doc.");
                         setDoc(userDocRef, { uid: user.uid, email: user.email, displayName: user.displayName || 'Unknown', createdAt: serverTimestamp(), isMember: false, membershipLevel: null, membershipExpiry: null, childName: null, childGrade: null }, { merge: true })
                         .catch(err => console.error("Error creating fallback user doc:", err));
                        updateMembershipStatusUI(false, null); clearPortalData();
                    }
                }, (error) => { console.error("Error listening to user document:", error); updateMembershipStatusUI(false, null); clearPortalData(); });

            } else {
                // User is signed out.
                console.log('User logged out');
                loginButton.classList.remove('hidden'); mobileLoginButton.classList.remove('hidden');
                portalLink.classList.add('hidden'); logoutButton.classList.add('hidden');
                mobilePortalLink.classList.add('hidden'); mobileLogoutButton.classList.add('hidden');
                if (membershipStatusContainer) membershipStatusContainer.innerHTML = '<p>Please log in to view membership status.</p>';
                clearPortalData();

                const currentPageId = document.querySelector('.page:not(.hidden)')?.id;
                if(currentPageId === 'portal-page') { // Only redirect away from portal page
                     if (window.showPage) window.showPage('home');
                }
            }
             // Update membership page UI based on login state
             if (window.updateMembershipPageUI) window.updateMembershipPageUI(user);
             // Update raffle page UI based on login state
             if (window.updateRafflePageUI) window.updateRafflePageUI(user);

        });

        // --- Update Membership Status UI (on Portal Page) ---
        function updateMembershipStatusUI(isMember, expiryDate) {
             if (!membershipStatusContainer) return;
             const now = new Date(); let statusHTML = '';
             if (isMember && expiryDate && expiryDate > now) { statusHTML = `<p class="text-lg text-green-600 font-semibold mb-2"><i class="fas fa-check-circle mr-2"></i>You are currently a member!</p><p>Your membership expires on: ${expiryDate.toLocaleDateString()}</p><button data-page="membership" class="btn btn-secondary mt-4">Renew Membership</button>`; }
             else if (isMember && expiryDate && expiryDate <= now) { statusHTML = `<p class="text-lg text-red-600 font-semibold mb-2"><i class="fas fa-exclamation-triangle mr-2"></i>Your membership has expired.</p><p>Expired on: ${expiryDate.toLocaleDateString()}</p><button data-page="membership" class="btn btn-primary mt-4">Renew Membership</button>`; }
             else { statusHTML = `<p class="text-lg text-gray-600 mb-2">You are not currently a member.</p><button data-page="membership" class="btn btn-primary mt-4">Become a Member</button>`; }
             membershipStatusContainer.innerHTML = statusHTML;
        }

        // --- Clear Portal Data (Hides all portal sections) ---
         function clearPortalData() {
             // Hide sections
             if(portalAnnouncements) portalAnnouncements.classList.add('hidden');
             if(portalMinutes) portalMinutes.classList.add('hidden');
             if(volunteerDashboard) volunteerDashboard.classList.add('hidden');

             // Clear content
             const announcementsGrid = document.getElementById('portal-announcements-grid');
             const minutesContainer = document.getElementById('portal-minutes-container');
             const volunteerGrid = document.getElementById('volunteer-events-grid');
             if(announcementsGrid) announcementsGrid.innerHTML = '';
             if(minutesContainer) minutesContainer.innerHTML = '';
             if(volunteerGrid) volunteerGrid.innerHTML = '';

             // Clear listeners
             if (unsubscribeVolunteer) unsubscribeVolunteer();
             Object.values(unsubscribeSlots).forEach(unsub => unsub());
             unsubscribeVolunteer = null;
             unsubscribeSlots = {};
         }

        // --- Listener Unsubscribes ---
        let unsubscribeVolunteer = null; let unsubscribeSlots = {};

        // --- PORTAL DATA LOADING (Now conditional) ---
        function loadPortalData(user, isMember, expiryDate) {
            // Unsubscribe from previous listeners
            if (unsubscribeVolunteer) unsubscribeVolunteer();
            Object.values(unsubscribeSlots).forEach(unsub => unsub());
            unsubscribeSlots = {};

             const announcementsGrid = document.getElementById('portal-announcements-grid');
             const minutesContainer = document.getElementById('portal-minutes-container');
             const volunteerGrid = document.getElementById('volunteer-events-grid');

             // --- VOLUNTEER DASHBOARD (Visible to all verified users) ---
            if (volunteerDashboard) volunteerDashboard.classList.remove('hidden');
            if (volunteerGrid) {
                const volunteerEventsRef = collection(db, 'volunteerEvents');
                unsubscribeVolunteer = onSnapshot(volunteerEventsRef, (snapshot) => {
                    if (snapshot.empty) { volunteerGrid.innerHTML = '<p class="text-center col-span-full">No volunteer opportunities available right now.</p>'; return; }
                    volunteerGrid.innerHTML = '';
                    snapshot.forEach(docSnap => {
                        const event = docSnap.data(); const eventId = docSnap.id;
                        const card = document.createElement('div'); card.className = 'bento-item flex flex-col text-left';
                        const eventDateStr = event.date?.seconds ? new Date(event.date.seconds * 1000).toLocaleDateString() : 'Date TBD';
                        card.innerHTML = `<h3 class="heading-font text-2xl text-brand-navy mb-2">${event.name}</h3><p class="font-bold text-brand-navy">${eventDateStr}</p><p class="flex-grow mb-4">${event.description || ''}</p><div id="slots-${eventId}" class="space-y-2 mt-auto">Loading slots...</div>`;
                        volunteerGrid.appendChild(card);

                        const volunteersRef = collection(db, `volunteerEvents/${eventId}/volunteers`);
                        if (unsubscribeSlots[eventId]) unsubscribeSlots[eventId]();
                        unsubscribeSlots[eventId] = onSnapshot(volunteersRef, (volunteersSnapshot) => {
                            const volunteers = new Set(volunteersSnapshot.docs.map(d => d.id));
                            const slotsContainer = document.getElementById(`slots-${eventId}`);
                            if (slotsContainer) {
                                slotsContainer.innerHTML = (event.slots || []).map(slot => {
                                    const isSignedUp = volunteers.has(`${user.uid}_${slot.replace(/\s|:/g, '-')}`);
                                    return `<div class="flex justify-between items-center bg-gray-100 p-2 rounded-md">
                                            <span>${slot}</span>
                                            <button class="volunteer-signup-btn btn ${isSignedUp ? 'bg-gray-400 text-gray-700 cursor-not-allowed' : 'btn-primary'} !py-1 !px-3 text-sm"
                                                    data-event-id="${eventId}" data-slot="${slot}" ${isSignedUp ? 'disabled' : ''}>
                                                ${isSignedUp ? 'Signed Up' : 'Sign Up'}
                                            </button>
                                        </div>`;
                                }).join('');
                                if (!event.slots || event.slots.length === 0) { slotsContainer.innerHTML = '<p class="text-sm text-gray-500">No specific time slots listed.</p>'; }
                            }
                        }, (error) => { console.error(`Error listening to volunteers:`, error); const slotsContainer = document.getElementById(`slots-${eventId}`); if(slotsContainer) slotsContainer.innerHTML = '<p class="text-red-500 text-sm">Error loading slots.</p>'; });
                    });
                }, (error) => { console.error("Error listening to volunteer events:", error); volunteerGrid.innerHTML = '<p class="text-center text-red-500 col-span-full">Error loading opportunities.</p>'; });
            }

             // --- MEMBERS-ONLY CONTENT ---
             if (isMember && expiryDate && expiryDate > new Date()) {
                 // --- Announcements (Mock Data) ---
                if (portalAnnouncements) portalAnnouncements.classList.remove('hidden');
                if (announcementsGrid) {
                    const announcements = [ { title: "Next PTA Meeting: Nov 5th", content: "Join us for our monthly meeting...", icon: "fas fa-calendar-alt" }, { title: "Call for Volunteers: Fall Book Fair", content: "We need helpers...", icon: "fas fa-book-open" }, ];
                    announcementsGrid.innerHTML = announcements.map(item => `
                        <div class="bento-item flex items-start">
                            <i class="${item.icon} text-3xl text-brand-red mr-6 mt-1" aria-hidden="true"></i>
                            <div><h3 class="heading-font text-2xl text-brand-navy mb-2">${item.title}</h3><p>${item.content}</p></div>
                        </div>`).join('');
                }
                // --- Meeting Minutes (Mock Data) ---
                if (portalMinutes) portalMinutes.classList.remove('hidden');
                if (minutesContainer) {
                     const minutes = [ { date: "October 1, 2025", link: "#" }, { date: "September 4, 2025", link: "#" } ];
                    minutesContainer.innerHTML = `<ul class="space-y-3">${minutes.map(item => `
                                <li class="flex justify-between items-center"><span class="text-lg">${item.date}</span><a href="${item.link}" target="_blank" rel="noopener noreferrer" class="btn btn-secondary !py-2 !px-4">Download PDF</a></li>`).join('')}</ul>`;
                }
             } else {
                 // User is verified but NOT a paid member
                 if (portalAnnouncements) portalAnnouncements.classList.remove('hidden'); // Show the section header
                 if(announcementsGrid) announcementsGrid.innerHTML = `<div class="bento-item text-center col-span-1 md:col-span-2"><p class="text-lg">This content is for paid PTA members only.</p><button data-page="membership" class="btn btn-primary mt-4">Become a Member</button></div>`;

                 if (portalMinutes) portalMinutes.classList.remove('hidden'); // Show the section header
                 if(minutesContainer) minutesContainer.innerHTML = `<p class="text-center text-lg">Access to meeting minutes is reserved for paid PTA members.</p><button data-page="membership" class="btn btn-primary mt-4">Become a Member</button>`;
             }
        }


        // --- AUTH EVENT LISTENERS ---
        document.body.addEventListener('click', async (e) => {
            // Volunteer signup
            if (e.target.classList.contains('volunteer-signup-btn')) {
                 e.preventDefault();
                 const btn = e.target; const { eventId, slot } = btn.dataset;
                 const user = auth.currentUser; if (!user) return;
                 btn.disabled = true; btn.textContent = 'Signing up...';
                 try {
                     const docId = `${user.uid}_${slot.replace(/\s|:/g, '-')}`;
                     await setDoc(doc(db, `volunteerEvents/${eventId}/volunteers`, docId), { userId: user.uid, userName: user.displayName || user.email, slot: slot, signupTime: serverTimestamp() });
                     console.log(`User ${user.uid} signed up`);
                 } catch (error) { console.error("Error signing up:", error); btn.disabled = false; btn.textContent = 'Sign Up'; }
            }

            // Logout
            if(e.target.id === 'logout-button' || e.target.id === 'mobile-logout-button' || e.target.closest('#logout-button') || e.target.closest('#mobile-logout-button')) {
                 e.preventDefault();
                 if (unsubscribeUser) unsubscribeUser(); if (unsubscribeVolunteer) unsubscribeVolunteer();
                 Object.values(unsubscribeSlots).forEach(unsub => unsub()); unsubscribeUser = null; unsubscribeVolunteer = null; unsubscribeSlots = {};
                 signOut(auth).catch(error => console.error('Logout failed:', error));
            }
            // Login Button Click (from Nav, Membership, Raffle, Leaderboard)
            if (e.target.id === 'login-button' || e.target.id === 'mobile-login-button' || e.target.id === 'join-now-login-button' || e.target.id === 'raffle-login-button' || e.target.id === 'leaderboard-login-button') {
                 e.preventDefault();
                 loginForm.reset(); signupForm.reset(); forgotPasswordForm.reset();
                 authMessage.textContent = ''; authMessage.className = 'text-center mt-4 font-medium';
                 signupContainer.classList.add('hidden'); forgotPasswordContainer.classList.add('hidden');
                 loginContainer.classList.remove('hidden');
                 authOverlay.classList.remove('hidden'); authOverlay.classList.add('flex');
            }
            // Membership button click from Portal status
             const membershipButton = e.target.closest('#membership-status-container button[data-page="membership"]');
             if (membershipButton) {
                  e.preventDefault();
                   if (window.showPage) window.showPage('membership');
                   else console.error("showPage function not available");
             }
             // Click on "Become a Member" from inside portal
             const portalMembershipButton = e.target.closest('#portal-announcements-grid button[data-page="membership"], #portal-minutes-container button[data-page="membership"]');
             if(portalMembershipButton) {
                 e.preventDefault();
                 if (window.showPage) window.showPage('membership');
             }

             // --- Auth Modal Toggles ---
             if (e.target.id === 'forgot-password-link') { e.preventDefault(); loginContainer.classList.add('hidden'); signupContainer.classList.add('hidden'); forgotPasswordContainer.classList.remove('hidden'); authMessage.textContent = ''; }
             if (e.target.id === 'back-to-login') { e.preventDefault(); forgotPasswordContainer.classList.add('hidden'); signupContainer.classList.add('hidden'); loginContainer.classList.remove('hidden'); authMessage.textContent = ''; }
             if (e.target.id === 'show-signup') { e.preventDefault(); loginContainer.classList.add('hidden'); forgotPasswordContainer.classList.add('hidden'); signupContainer.classList.remove('hidden'); authMessage.textContent = ''; }
             if (e.target.id === 'show-login') { e.preventDefault(); signupContainer.classList.add('hidden'); forgotPasswordContainer.classList.add('hidden'); loginContainer.classList.remove('hidden'); authMessage.textContent = ''; }
             if (e.target.id === 'close-auth-button') { authOverlay?.classList.add('hidden'); authOverlay?.classList.remove('flex'); }
             
             // --- Raffle Link Copy ---
             if (e.target.id === 'copy-referral-link') {
                 e.preventDefault();
                 if(referralLinkInput) {
                     referralLinkInput.select();
                     try {
                         // Use modern clipboard API if available (preferred)
                         await navigator.clipboard.writeText(referralLinkInput.value);
                         e.target.textContent = 'Copied!';
                     } catch (err) {
                         // Fallback for older browsers
                         console.error('Clipboard API failed, trying fallback...');
                         try {
                            document.execCommand('copy');
                            e.target.textContent = 'Copied!';
                         } catch (err2) {
                            console.error('Fallback execCommand failed:', err2);
                            e.target.textContent = 'Copy Failed';
                         }
                     }
                     setTimeout(() => { e.target.textContent = 'Copy Link'; }, 2000);
                 }
             }
        });

        // --- FORM SUBMISSION HANDLERS ---
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const forgotPasswordForm = document.getElementById('forgot-password-form');
        const signupButton = signupForm.querySelector('button[type="submit"]');
        const loginButtonElement = loginForm.querySelector('button[type="submit"]');
        const resetButton = forgotPasswordForm.querySelector('button[type="submit"]');

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            authMessage.textContent = ''; authMessage.className = 'text-center mt-4 font-medium text-red-500';
            const originalLoginButtonText = loginButtonElement.textContent;
            loginButtonElement.disabled = true; loginButtonElement.textContent = 'Logging In...';
            const email = loginForm['login-email'].value; const password = loginForm['login-password'].value;

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    if (!userCredential.user.emailVerified) {
                        authMessage.textContent = 'Please verify your email address first. Check your inbox (and spam folder).';
                        signOut(auth); // Sign out unverified user immediately
                    } else {
                        console.log('Logged in & verified', userCredential.user);
                        authOverlay.classList.add('hidden'); authOverlay.classList.remove('flex'); loginForm.reset();
                        authMessage.textContent = '';
                        if (window.updateMembershipPageUI) window.updateMembershipPageUI(userCredential.user);
                        if (window.updateRafflePageUI) window.updateRafflePageUI(userCredential.user); // Update raffle page too
                    }
                })
                .catch((error) => { console.error('Login error:', error.code); authMessage.textContent = getFriendlyAuthErrorMessage(error); })
                .finally(() => { loginButtonElement.disabled = false; loginButtonElement.textContent = originalLoginButtonText; });
        });

        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            authMessage.textContent = ''; authMessage.className = 'text-center mt-4 font-medium text-red-500';
            const originalButtonText = signupButton.textContent;
            signupButton.disabled = true; signupButton.textContent = 'Signing Up...';
            const name = signupForm['signup-name'].value; const email = signupForm['signup-email'].value; const password = signupForm['signup-password'].value;
            const childName = signupForm['signup-child-name'].value; const childGrade = signupForm['signup-child-grade'].value;
            if (!name || !email || !password || !childName || !childGrade) { authMessage.textContent = "Please fill out all fields."; signupButton.disabled = false; signupButton.textContent = originalButtonText; return; }
            if (password.length < 6) { authMessage.textContent = "Password must be at least 6 characters."; signupButton.disabled = false; signupButton.textContent = originalButtonText; return; }

            let createdUser = null; let success = false;
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                createdUser = userCredential.user; console.log('Signed up Auth user', createdUser);
                authMessage.textContent = 'Account created, saving details...'; authMessage.className = 'text-center mt-4 font-medium text-green-600';
                
                const userDocRef = doc(db, "users", createdUser.uid);
                await setDoc(userDocRef, { uid: createdUser.uid, email: createdUser.email, displayName: name, childName: childName, childGrade: childGrade, createdAt: serverTimestamp(), isMember: false, membershipLevel: null, membershipExpiry: null });
                console.log("Firestore updated");
                
                await updateProfile(createdUser, { displayName: name });
                console.log('Auth profile updated');
                
                await sendEmailVerification(createdUser);
                console.log('Verification email sent.');
                
                success = true;
                authMessage.textContent = 'Account created! Please check your email (and spam folder) to verify.';
                authMessage.className = 'text-center mt-4 font-medium text-green-600';
                setTimeout(() => {
                    authOverlay.classList.add('hidden'); authOverlay.classList.remove('flex');
                    signupForm.reset(); authMessage.textContent = '';
                }, 4000);
            } catch (error) {
                console.error('Signup/Verification error:', error);
                if (error.code && error.code.startsWith('auth/')) { authMessage.textContent = getFriendlyAuthErrorMessage(error); }
                else { authMessage.textContent = "An error occurred saving details or sending verification. Please contact support."; }
                authMessage.className = 'text-center mt-4 font-medium text-red-500';
            } finally {
                // This block runs after try OR catch
                // If the process was successful, the setTimeout will reset the button
                // If it failed, reset it now
                if (!success) {
                    signupButton.disabled = false;
                    signupButton.textContent = originalButtonText;
                }
            }
        });


        // --- Forgot Password Form Handler ---
         forgotPasswordForm.addEventListener('submit', (e) => {
             e.preventDefault();
             authMessage.textContent = ''; authMessage.className = 'text-center mt-4 font-medium';
             const originalResetText = resetButton.textContent;
             resetButton.disabled = true; resetButton.textContent = 'Sending...';
             const email = forgotPasswordForm['reset-email'].value;
             sendPasswordResetEmail(auth, email)
                 .then(() => {
                     console.log('Password reset email sent to:', email);
                     authMessage.textContent = 'Password reset email sent. Please check your inbox (and spam folder).';
                     authMessage.classList.add('text-green-600');
                     forgotPasswordForm.reset();
                     setTimeout(() => {
                         forgotPasswordContainer.classList.add('hidden');
                         loginContainer.classList.remove('hidden');
                         authMessage.textContent = '';
                     }, 4000);
                 })
                 .catch((error) => { console.error('Password reset error:', error.code); authMessage.textContent = getFriendlyAuthErrorMessage(error); authMessage.classList.add('text-red-500'); })
                 .finally(() => { resetButton.disabled = false; resetButton.textContent = originalResetText; });
         });


        // --- Helper for user-friendly auth errors ---
        function getFriendlyAuthErrorMessage(error) {
            if (!error || !error.code) { console.error("Unknown error object:", error); return 'An unexpected error occurred.'; }
            switch (error.code) {
                case 'auth/invalid-email': return 'Please enter a valid email address.';
                case 'auth/user-disabled': return 'This account has been disabled.';
                case 'auth/user-not-found': return 'No account found with this email address.';
                case 'auth/wrong-password': return 'Incorrect password. Please try again.';
                case 'auth/email-already-in-use': return 'This email address is already registered. Please log in.';
                case 'auth/weak-password': return 'Password is too weak. Please use at least 6 characters.';
                case 'auth/operation-not-allowed': return 'Email/password sign-up is disabled.';
                case 'auth/missing-password': return 'Please enter your password.';
                case 'auth/invalid-credential': return 'Invalid email or password.';
                default: console.error("Unhandled Auth Error:", error); return 'An unexpected error occurred. Please try again.';
            }
        }

        // --- MEMBERSHIP FORM LOGIC ---
        const membershipForm = document.getElementById('membership-form');
        const membershipError = document.getElementById('membership-error');
        window.updateMembershipAfterPayment = async function (userId, selectedLevel) {
            if (!userId || !selectedLevel) { console.error("Missing info for membership update"); if (membershipError) membershipError.textContent = "Error processing update."; return; }
            const userDocRef = doc(db, "users", userId);
            const expiryDate = new Date(); expiryDate.setFullYear(expiryDate.getFullYear() + 1);
            try {
                await updateDoc(userDocRef, { isMember: true, membershipLevel: selectedLevel, membershipExpiry: expiryDate });
                console.log("Membership updated!");
                const successMsg = document.createElement('p'); successMsg.textContent = "Membership Activated! Redirecting..."; successMsg.className = "text-green-600 text-center font-bold mt-4";
                membershipForm?.parentNode?.insertBefore(successMsg, membershipForm.nextSibling);
                setTimeout(() => { successMsg.remove(); if (window.showPage) window.showPage('portal'); }, 3000);
            } catch (error) { console.error("Error updating membership:", error); if (membershipError) membershipError.textContent = "Failed to update status after payment. Contact support."; }
        }
        
        // --- DONATION FORM LOGIC ---
        if(donationForm) {
            donationForm.addEventListener('change', (e) => {
                if (e.target.name === 'donationAmount') {
                    if (e.target.value === 'other') {
                        customAmountContainer.classList.remove('hidden');
                    } else {
                        customAmountContainer.classList.add('hidden');
                    }
                }
            });
        }

    </script>

    <script>
        // --- NON-MODULE SCRIPT for navigation, UI effects etc. ---
        document.addEventListener('DOMContentLoaded', function () {
            // --- HERO CANVAS ANIMATION ---
             const canvas = document.getElementById('hero-canvas');
            if (canvas) {
                // console.log("Canvas found, initializing animation."); // Less verbose
                const ctx = canvas.getContext('2d');
                let particlesArray;
                let animationFrameId;

                const resizeCanvas = () => {
                    const hero = document.getElementById('interactive-hero');
                    if (!hero) return;
                    if (hero.offsetWidth > 0 && hero.offsetHeight > 0) {
                        canvas.width = hero.offsetWidth;
                        canvas.height = hero.offsetHeight;
                        // console.log(`Canvas resized to ${canvas.width}x${canvas.height}`);
                        initConstellation();
                    } else {
                        // console.warn("Hero element has zero dimensions, skipping canvas resize.");
                    }
                };

                const mouse = { x: null, y: null, radius: 100 };
                function updateMouseRadius() { mouse.radius = Math.max(50, Math.min(200, (canvas.height / 80) * (canvas.width / 80))); }

                window.addEventListener('mousemove', function(event) { let rect = canvas.getBoundingClientRect(); mouse.x = event.clientX - rect.left; mouse.y = event.clientY - rect.top; });
                window.addEventListener('mouseout', function() { mouse.x = undefined; mouse.y = undefined; });

                class Particle {
                     constructor(x, y, directionX, directionY, size) { this.x = x; this.y = y; this.baseX = x; this.baseY = y; this.directionX = directionX; this.directionY = directionY; this.size = size; this.color = 'rgba(213, 185, 149, 0.5)'; this.density = (Math.random() * 20) + 5; }
                     draw() { ctx.fillStyle = this.color; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.closePath(); ctx.fill(); }
                     update() {
                         if (canvas.width === 0 || canvas.height === 0) return;
                         let dxMouse = mouse.x - this.x; let dyMouse = mouse.y - this.y; let distanceMouse = Math.sqrt(dxMouse * dxMouse + dyMouse * dyMouse);
                         let forceDirectionX = dxMouse / distanceMouse; let forceDirectionY = dyMouse / distanceMouse; let maxDistance = mouse.radius; let force = (maxDistance - distanceMouse) / maxDistance;
                         if (distanceMouse < maxDistance && mouse.x !== undefined) { let pushStrength = force * this.density * 0.1; this.x -= forceDirectionX * pushStrength; this.y -= forceDirectionY * pushStrength; this.directionX *= 0.98; this.directionY *= 0.98; }
                         else { const speedSq = this.directionX * this.directionX + this.directionY * this.directionY; if (speedSq < 0.01) { if (this.x !== this.baseX) { let dxToBase = this.x - this.baseX; this.x -= dxToBase / 30; } if (this.y !== this.baseY) { let dyToBase = this.y - this.baseY; this.y -= dyToBase / 30; } } this.x += this.directionX; this.y += this.directionY; }
                         if (this.x + this.size > canvas.width || this.x - this.size < 0) { this.directionX = -this.directionX * 0.8; if (this.x + this.size > canvas.width) this.x = canvas.width - this.size; if (this.x - this.size < 0) this.x = this.size; }
                         if (this.y + this.size > canvas.height || this.y - this.size < 0) { this.directionY = -this.directionY * 0.8; if (this.y + this.size > canvas.height) this.y = canvas.height - this.size; if (this.y - this.size < 0) this.y = this.size; }
                         this.directionX *= 0.995; this.directionY *= 0.995; this.draw();
                     }
                 }

                function initConstellation() {
                     particlesArray = []; if (canvas.width === 0 || canvas.height === 0) return;
                     let numParticles = Math.max(50, Math.floor((canvas.height * canvas.width) / 15000));
                     // console.log(`Initializing ${numParticles} particles.`);
                     for (let i = 0; i < numParticles; i++) { let size = (Math.random() * 1.5) + 0.5; let x = Math.random() * (canvas.width - size * 2) + size; let y = Math.random() * (canvas.height - size * 2) + size; let dX = (Math.random() * .3) - 0.15; let dY = (Math.random() * .3) - 0.15; particlesArray.push(new Particle(x, y, dX, dY, size)); }
                     updateMouseRadius();
                 }

                function connect() {
                    if (!particlesArray || canvas.width === 0 || canvas.height === 0) return;
                    const connectDistanceSq = Math.pow(Math.min(canvas.width, canvas.height) / 10, 2); ctx.lineWidth = 0.5;
                    for (let a = 0; a < particlesArray.length; a++) {
                        for (let b = a + 1; b < particlesArray.length; b++) { let dx = particlesArray[a].x - particlesArray[b].x; let dy = particlesArray[a].y - particlesArray[b].y; let distSq = dx*dx + dy*dy; if (distSq < connectDistanceSq) { let opacity = 1 - (distSq / connectDistanceSq); ctx.strokeStyle = `rgba(213, 185, 149, ${opacity * 0.5})`; ctx.beginPath(); ctx.moveTo(particlesArray[a].x, particlesArray[a].y); ctx.lineTo(particlesArray[b].x, particlesArray[b].y); ctx.stroke(); } }
                    }
                }

                let lastTime = 0; const fps = 30; const frameDuration = 1000 / fps;
                function animateConstellation(currentTime = 0) {
                    animationFrameId = requestAnimationFrame(animateConstellation);
                    if (canvas.width === 0 || canvas.height === 0) return;
                    const deltaTime = currentTime - lastTime;
                    if (deltaTime < frameDuration) { return; } lastTime = currentTime - (deltaTime % frameDuration);
                    ctx.clearRect(0,0,canvas.width, canvas.height); if (!particlesArray) return;
                    for (let i = 0; i < particlesArray.length; i++) { particlesArray[i].update(); } connect();
                }

                 let resizeTimeout; window.addEventListener('resize', () => { clearTimeout(resizeTimeout); resizeTimeout = setTimeout(() => { if(animationFrameId) cancelAnimationFrame(animationFrameId); resizeCanvas(); animateConstellation(); }, 250); });

                setTimeout(() => { resizeCanvas(); animateConstellation(); /* console.log("Animation setup complete."); */ }, 100);
             } else {
                 console.error("Hero canvas element not found!");
             }


            // --- DATA ---
             const foundersData = [ { name: 'Dr. Evelyn Reed', title: 'Founder & Head of School', photo: 'https://images.unsplash.com/photo-1573496799652-408c2ac9fe98?auto=format&fit=crop&q=80&w=150&h=150' }, { name: 'Mr. David Chen', title: 'Co-Founder & Board Chair', photo: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&q=80&w=150&h=150' }, { name: 'Ms. Maria Garcia', title: 'Board Member', photo: 'https://images.unsplash.com/photo-1580489944761-15a19d654956?auto=format&fit=crop&q=80&w=150&h=150' }, { name: 'Mr. Johnathan Lee', title: 'Board Member', photo: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&q=80&w=150&h=150' }, ];
             const committeeData = [ { name: 'Web App Committee', title: 'Analysis, Design & Implementation', photo: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&q=80&w=150&h=150' }, ];
             const ptaBoardData = { 'Han Yi': { title: 'President', photo: 'https://images.unsplash.com/photo-1573496799652-408c2ac9fe98?auto=format&fit=crop&q=80&w=400&h=500' }, 'John Smith': { title: 'Vice President', photo: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&q=80&w=400&h=500' }, 'Emily White': { title: 'Secretary', photo: 'https://images.unsplash.com/photo-1580489944761-15a19d654956?auto=format&fit=crop&q=80&w=400&h=500' }, 'Michael Brown': { title: 'Treasurer', photo: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&q=80&w=400&h=500' }, };
             const teamsData = { 'Vex V5': { category: 'stem', what: 'Vex V5 is a robotics competition...', do: 'We participate in tournaments...', coaches: [ { name: 'Mr. Smith', email: 'jsmith@email.com', photo: '...' }, { name: 'Ms. Jones', email: 'sjones@email.com', photo: '...' } ], awards: ['...'] }, 'Vex IQ': { category: 'stem', what: 'Aimed at younger students...', do: 'Our team learns fundamentals...', coaches: [ { name: 'Ms. Davis', email: 'davis@email.com', photo: '...' } ], awards: ['...'] }, 'Science Bee': { category: 'stem', what: 'A buzzer-based competition...', do: 'Students compete individually...', coaches: [ { name: 'Mr. White', email: 'white@email.com', photo: '...' } ], awards: [] }, 'Speech + Debate': { category: 'comm-art', what: 'Students develop public speaking...', do: 'We compete in various formats...', coaches: [ { name: 'Mrs. Green', email: 'green@email.com', photo: '...' } ], awards: ['...'] }, 'Chess': { category: 'comm-art', what: 'A strategy board game...', do: 'Our club welcomes all levels...', coaches: [ { name: 'Mr. Black', email: 'black@email.com', photo: '...' } ], awards: ['...'] }, 'Latin': { category: 'comm-art', what: 'An academic team focused on Latin...', do: 'We participate in Certamen...', coaches: [ { name: 'Dr. Brown', email: 'brown@email.com', photo: '...' } ], awards: [] }, 'Science Olympiad': { category: 'science', what: 'A team competition...', do: 'Events range from labs...', coaches: [ { name: 'Ms. Adams', email: 'adams@email.com', photo: '...' } ], awards: ['...'] }, 'Science Bowl': { category: 'science', what: 'A fast-paced quiz bowl...', do: 'Teams of four compete...', coaches: [ { name: 'Mr. Clark', email: 'clark@email.com', photo: '...' } ], awards: [] }, 'Physics Bowl': { category: 'science', what: 'An individual and team competition...', do: 'Students take a 40-question test...', coaches: [ { name: 'Mr. Kent', email: 'kent@email.com', photo: '...' } ], awards: [] }, 'Mu Alpha Theta': { category: 'math', what: 'The National Math Honor Society.', do: 'We participate in competitions...', coaches: [ { name: 'Mrs. Rogers', email: 'rogers@email.com', photo: '...' } ], awards: ['...'] }, 'ARML': { category: 'math', what: 'The American Regions Mathematics League...', do: 'Our team travels to compete...', coaches: [ { name: 'Mrs. Rogers', email: 'rogers@email.com', photo: '...' } ], awards: [] }, 'M3 Challenge': { category: 'math', what: 'A math modeling competition...', do: 'Teams work for 14 hours...', coaches: [ { name: 'Mr. Stark', email: 'stark@email.com', photo: '...' } ], awards: [] }, 'Mid/HiMCM': { category: 'math', what: 'High School Mathematical Contest...', do: 'Teams work to model...', coaches: [ { name: 'Mr. Stark', email: 'stark@email.com', photo: '...' } ], awards: [] }, 'Math Prize for Girls': { category: 'math', what: 'A prestigious national math competition...', do: 'We support and prepare...', coaches: [ { name: 'Ms. Prince', email: 'prince@email.com', photo: '...' } ], awards: [] }, 'History Bowl': { category: 'social', what: 'A buzzer-based team competition...', do: 'Teams compete to answer...', coaches: [ { name: 'Mr. Wayne', email: 'wayne@email.com', photo: '...' } ], awards: [] }, 'Quiz Bowl': { category: 'social', what: 'A fast-paced team competition...', do: 'We compete in local leagues...', coaches: [ { name: 'Mr. Parker', email: 'parker@email.com', photo: '...' } ], awards: [] }, 'History Bee': { category: 'social', what: 'An individual buzzer-based competition...', do: 'Students compete on their...', coaches: [ { name: 'Mr. Wayne', email: 'wayne@email.com', photo: '...' } ], awards: [] }, 'Geography Bee': { category: 'social', what: 'An individual competition...', do: 'Students answer questions...', coaches: [ { name: 'Ms. Lane', email: 'lane@email.com', photo: '...' } ], awards: [] }, 'Finance': { category: 'business', what: 'A club that explores finance...', do: 'We participate in stock market games...', coaches: [ { name: 'Mr. Gordon', email: 'gordon@email.com', photo: '...' } ], awards: [] }, 'Model UN': { category: 'business', what: 'A simulation of the UN...', do: 'Students debate global issues...', coaches: [ { name: 'Ms. Carter', email: 'carter@email.com', photo: '...' } ], awards: [] }, };
             const eventsData = [ { name: "Annual PTA Bake Sale", date: new Date(2025, 9, 25, 11, 0), location: "School Cafeteria", description: "Support the PTA...", icon: "fas fa-cookie-bite" }, { name: "Science Olympiad Info Session", date: new Date(2025, 9, 25, 11, 0), location: "Auditorium", description: "Learn about joining...", icon: "fas fa-atom" }, { name: "Fall Festival", date: new Date(2025, 10, 15, 13, 0), location: "School Grounds", description: "A day of games, food...", icon: "fas fa-leaf" }, { name: "Winter Concert", date: new Date(2025, 11, 12, 19, 0), location: "Auditorium", description: "Enjoy a magical evening...", icon: "fas fa-music" }, { name: "Parent-Teacher Conferences", date: new Date(2026, 0, 16, 8, 0), location: "Various Classrooms", description: "Discuss your child's progress...", icon: "fas fa-comments" }, { name: "Book Fair", date: new Date(2026, 1, 3, 9, 0), location: "Library", description: "Discover new books...", icon: "fas fa-book-open" } ]; eventsData.forEach(e => { if (!(e.date instanceof Date)) e.date = new Date(e.date); });
             const clubsData = { 'Art Club': { description: 'Express creativity...', meetings: 'Tuesdays...', sponsor: { name: 'Ms. Kahlo', title: 'Faculty Sponsor', email: 'fkahlo@email.com', photo: '...' }, gallery: ['...'], icon: "fas fa-palette" }, 'Drama Club': { description: 'Theater fun...', meetings: 'Thursdays...', sponsor: { name: 'Mr. Shakespeare', title: 'Faculty Sponsor', email: 'wshakespeare@email.com', photo: '...' }, gallery: ['...'], icon: "fas fa-theater-masks" }, 'Creative Writing Club': { description: 'Share stories...', meetings: 'Wednesdays...', sponsor: { name: 'Ms. Austen', title: 'Faculty Sponsor', email: 'jausten@email.com', photo: '...' }, gallery: [], icon: "fas fa-pen-fancy" }, 'Coding Club': { description: 'Learn programming...', meetings: 'Mondays...', sponsor: { name: 'Ms. Lovelace', title: 'Faculty Sponsor', email: 'alovelace@email.com', photo: '...' }, gallery: ['...'], icon: "fas fa-code" }, 'Environmental Club': { description: 'Promote sustainability...', meetings: 'Fridays...', sponsor: { name: 'Mr. Carson', title: 'Faculty Sponsor', email: 'rcarson@email.com', photo: '...' }, gallery: [], icon: "fas fa-leaf" }, 'Community Service Club': { description: 'Make a positive impact...', meetings: 'First Saturday...', sponsor: { name: 'Mrs. King', title: 'Faculty Sponsor', email: 'mlking@email.com', photo: '...' }, gallery: ['...'], icon: "fas fa-hands-helping" } };
             const newsData = [ { title: "Debate Team Wins State Championship!", date: new Date(2025, 9, 18), author: "Frazer School Staff", image: "https://images.unsplash.com/photo-1522071820081-009f0129c71c?auto=format&fit=crop&q=80&w=800&h=500", excerpt: "Our incredible Debate Team secured first place...", fullContent: `<p>Our incredible Debate Team secured first place at the state championship last weekend. Their dedication, sharp arguments, and countless hours of practice have made our entire school community proud. This victory is a testament to their hard work and the excellent guidance of their coaches.</p><p>The final round was a nail-biter against Northwood High, with our team arguing passionately on the topic of renewable energy policies. The judges commended their well-researched points and persuasive delivery. The team, consisting of captains Sarah Jenkins and Leo Kim, along with members Fatima Al-Jamil and Ben Carter, brought home the first-place trophy, marking a historic win for The Frazer School.</p><p>"We couldn't have done it without the support of our teachers and the entire school community," said Sarah Jenkins. "This win isn't just for us; it's for everyone who believed in us."</p>` }, { title: "PTA Announces Annual Fall Festival", date: new Date(), author: "PTA Board", image: "https://images.unsplash.com/photo-1543269865-cbf427effbad?auto=format&fit=crop&q=80&w=800&h=500", excerpt: "Get ready for a day of fun...", fullContent: `<p>Get ready for a day of fun, food, and community at our annual Fall Festival! Mark your calendars for Saturday, November 15th, from 1 PM to 5 PM on the school grounds.</p><p>This year's festival will feature a variety of activities for all ages, including carnival games, a pumpkin decorating station, a petting zoo, and live music from local bands. The PTA will also be running a bake sale and a chili cook-off, so come hungry!</p><p>All proceeds from the festival will go towards funding new technology for our classrooms. We are looking for volunteers to help run the booths. If you are interested in volunteering, please sign up using the link on the PTA page. We can't wait to see you there for a wonderful community celebration!</p>` }, { title: "Science Olympiad Team Prepares for Regionals", date: new Date(2025, 9, 10), author: "Science Department", image: "https://images.unsplash.com/photo-1503676260728-1c00da094a0b?auto=format&fit=crop&q=80&w=800&h=500", excerpt: "Our Science Olympiad team is hard at work...", fullContent: `<p>Our Science Olympiad team is hard at work preparing for the upcoming regional competition, which will be held next month. The team has been meeting twice a week to build, study, and practice for the 23 different events that span various scientific disciplines.</p><p>This year, students are constructing everything from intricate model bridges to battery-powered vehicles. In the lab, they are honing their skills in chemistry, forensics, and astronomy. Under the guidance of Ms. Adams, the team is optimistic about their chances of advancing to the state level.</p><p>"The students have shown incredible dedication and ingenuity," said Ms. Adams. "They are not just memorizing facts; they are learning how to think like scientists and engineers. We are incredibly proud of their progress."</p>` } ]; newsData.forEach(n => { if (!(n.date instanceof Date)) n.date = new Date(n.date); });


            // --- DYNAMIC CONTENT RENDERING ---
             // Teams List
             const teamsGridContainer = document.getElementById('teams-grid-container');
             if(teamsGridContainer) {
                 teamsGridContainer.innerHTML = `
                    <div><h2 class="heading-font text-2xl text-brand-navy border-b-2 border-brand-red pb-2 mb-4">STEM</h2><ul class="space-y-3" id="teams-list-stem"></ul></div>
                    <div><h2 class="heading-font text-2xl text-brand-navy border-b-2 border-brand-red pb-2 mb-4">Communication + Art</h2><ul class="space-y-3" id="teams-list-comm-art"></ul></div>
                    <div><h2 class="heading-font text-2xl text-brand-navy border-b-2 border-brand-red pb-2 mb-4">Science</h2><ul class="space-y-3" id="teams-list-science"></ul></div>
                    <div><h2 class="heading-font text-2xl text-brand-navy border-b-2 border-brand-red pb-2 mb-4">Math</h2><ul class="space-y-3" id="teams-list-math"></ul></div>
                    <div><h2 class="heading-font text-2xl text-brand-navy border-b-2 border-brand-red pb-2 mb-4">Social Science</h2><ul class="space-y-3" id="teams-list-social"></ul></div>
                    <div><h2 class="heading-font text-2xl text-brand-navy border-b-2 border-brand-red pb-2 mb-4">Business</h2><ul class="space-y-3" id="teams-list-business"></ul></div>
                `;
                 Object.keys(teamsData).forEach(teamName => {
                     const team = teamsData[teamName];
                     const listId = `teams-list-${team.category}`;
                     const listEl = document.getElementById(listId);
                     if (listEl) {
                         const listItem = document.createElement('li');
                         listItem.innerHTML = `<a href="#" class="hover:text-brand-red transition-colors" data-page="team-detail" data-team="${teamName}">${teamName}</a>`;
                         listEl.appendChild(listItem);
                     }
                 });
             }

             // Clubs Grid
             const clubsGrid = document.getElementById('clubs-grid');
             if (clubsGrid) {
                 clubsGrid.innerHTML = ''; // Clear loading message
                 Object.keys(clubsData).forEach((clubName, index) => {
                     const club = clubsData[clubName];
                     const card = document.createElement('div');
                     card.className = 'bento-item flex flex-col items-center text-center reveal';
                     card.style.transitionDelay = `${index * 100}ms`;
                     card.innerHTML = `<i class="${club.icon || 'fas fa-question-circle'} text-4xl text-brand-red mb-4" aria-hidden="true"></i><h3 class="heading-font text-2xl text-brand-navy mb-2">${clubName}</h3><p class="flex-grow">${club.description}</p><a href="#" class="btn btn-secondary mt-6" data-page="club-detail" data-club="${clubName}">Learn More</a>`;
                     clubsGrid.appendChild(card);
                 });
             }

             // Events Grid
             const eventsGrid = document.getElementById('events-grid');
             if (eventsGrid) {
                 eventsGrid.innerHTML = ''; // Clear loading message
                 eventsData.sort((a,b)=>a.date - b.date).forEach((event, index) => {
                     const card = document.createElement('div');
                     card.className = 'bento-item flex flex-col text-left reveal';
                     card.style.transitionDelay = `${index * 100}ms`;
                     const calendarLink = createGoogleCalendarLink(event);
                     const eventDate = event.date.toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});
                     const eventTime = event.date.toLocaleTimeString([],{hour:'numeric',minute:'2-digit'});
                     card.innerHTML = `<div class="flex items-start justify-between mb-4"><h3 class="heading-font text-2xl text-brand-navy mb-0 mr-4">${event.name}</h3><i class="${event.icon || 'fas fa-calendar-alt'} text-3xl text-brand-red" aria-hidden="true"></i></div><p class="font-bold text-brand-navy">${eventDate} | ${eventTime}</p><p class="font-bold text-brand-navy mb-2">${event.location}</p><p class="flex-grow">${event.description}</p><a href="${calendarLink}" target="_blank" class="btn btn-secondary mt-6 w-full md:w-auto self-start">Add to Calendar</a>`;
                     eventsGrid.appendChild(card);
                 });
             }

             // News Grid
             const newsGrid = document.getElementById('news-grid');
             if (newsGrid) {
                 newsGrid.innerHTML = ''; // Clear loading message
                 newsData.sort((a,b)=>b.date - a.date).forEach((article, index) => {
                     const card = document.createElement('div');
                     card.className = 'bento-item flex flex-col reveal';
                     card.style.transitionDelay = `${index * 100}ms`;
                     card.innerHTML = `
                        <img src="${article.image}" alt="${article.title}" class="rounded-lg mb-4 aspect-[16/10] object-cover">
                        <h3 class="heading-font text-2xl text-brand-navy mb-2">${article.title}</h3>
                        <p class="text-sm text-gray-500 mb-2">By ${article.author} on ${article.date.toLocaleDateString()}</p>
                        <p class="flex-grow">${article.excerpt}</p>
                        <a href="#" class="text-brand-red font-bold mt-4 self-start hover:underline" data-page="news-detail" data-news="${article.title}">Read More &rarr;</a>`;
                     newsGrid.appendChild(card);
                 });
             }

             // Google Calendar Link Helper
             function createGoogleCalendarLink(event) {
                const base = 'https://www.google.com/calendar/render?action=TEMPLATE';
                function fmt(d){return d.toISOString().replace(/-|:|\.\d\d\d/g,"");}
                const st=fmt(event.date);
                const en=fmt(new Date(event.date.getTime()+3600000)); // 1 hour duration
                const p=new URLSearchParams({text:event.name, dates:`${st}/${en}`, details:event.description, location:event.location});
                return `${base}&${p.toString()}`;
             }

             // Upcoming Event Countdown
             let currentCountdownInterval = null; // Use the global variable
             function displayUpcomingEvent() {
                 if(currentCountdownInterval) { clearInterval(currentCountdownInterval); currentCountdownInterval = null; }
                 const now = new Date();
                 const container = document.getElementById('up-next-event');
                 if (!container) { console.warn("Upcoming event container not found."); return; }

                 const future = eventsData.filter(e => e.date > now).sort((a, b) => a.date - b.date);

                 if (future.length > 0) {
                     const nextTime = future[0].date;
                     const simultaneous = future.filter(e => e.date.getTime() === nextTime.getTime());
                     let contentHTML;
                     if (simultaneous.length > 1) {
                         contentHTML = `<h3 class="heading-font text-3xl text-brand-navy mb-4">Happening Next</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-left">${simultaneous.map(ev => `<div class="bento-item !p-6"><h4 class="heading-font text-2xl text-brand-navy">${ev.name}</h4><p class="font-bold">${ev.date.toLocaleDateString([],{month:'long',day:'numeric'})} at ${ev.date.toLocaleTimeString([],{hour:'numeric',minute:'2-digit'})}</p><p class="mb-4">${ev.location}</p><a href="${createGoogleCalendarLink(ev)}" target="_blank" class="btn btn-secondary btn-sm">Add to Calendar</a></div>`).join('')}</div>`;
                     } else {
                         const next = simultaneous[0];
                         contentHTML = `<h3 class="heading-font text-3xl text-brand-navy mb-2">${next.name}</h3><p class="text-lg mb-4">${next.date.toLocaleDateString([],{year:'numeric',month:'long',day:'numeric'})} at ${next.date.toLocaleTimeString([],{hour:'numeric',minute:'2-digit'})}</p><a href="${createGoogleCalendarLink(next)}" target="_blank" class="btn btn-secondary">Add to Calendar</a>`;
                     }
                     container.innerHTML = `<div id="countdown" class="flex justify-center space-x-4 text-brand-navy font-bold text-4xl mb-6"><div><span id="days">00</span><p class="text-sm font-normal">Days</p></div><div><span id="hours">00</span><p class="text-sm font-normal">Hours</p></div><div><span id="minutes">00</span><p class="text-sm font-normal">Minutes</p></div><div><span id="seconds">00</span><p class="text-sm font-normal">Seconds</p></div></div>${contentHTML}`;

                     currentCountdownInterval = setInterval(() => { // Assign to the global variable
                         const dist = nextTime.getTime() - new Date().getTime();
                         if(dist < 0){ clearInterval(currentCountdownInterval); currentCountdownInterval = null; displayUpcomingEvent(); return; }
                         // Update elements directly inside interval, checking existence
                         const dEl = document.getElementById('days');
                         const hEl = document.getElementById('hours');
                         const mEl = document.getElementById('minutes');
                         const sEl = document.getElementById('seconds');
                         if(dEl) dEl.innerText = String(Math.floor(dist/(1e3*60*60*24))).padStart(2,'0');
                         if(hEl) hEl.innerText = String(Math.floor((dist%(1e3*60*60*24))/(1e3*60*60))).padStart(2,'0');
                         if(mEl) mEl.innerText = String(Math.floor((dist%(1e3*60*60))/(1e3*60))).padStart(2,'0');
                         if(sEl) sEl.innerText = String(Math.floor((dist%(1e3*60))/1e3)).padStart(2,'0');
                     }, 1000);
                 } else {
                     container.innerHTML = '<h3 class="heading-font text-3xl text-brand-navy">No upcoming events scheduled.</h3>';
                 }
             }
             // Star Confetti
             function startStarConfetti(canvasId) {
                const canvas = document.getElementById(canvasId); if(!canvas) return; const ctx=canvas.getContext('2d'); let animId; const resize=()=>{if(canvas.offsetWidth > 0 && canvas.offsetHeight > 0){canvas.width=canvas.offsetWidth; canvas.height=canvas.offsetHeight;}}; window.addEventListener('resize', resize); resize(); let particles=[]; const colors=['#B91C1C','#FFFFFF','#0F172A']; function createP(){const x=Math.random()*canvas.width;const y=-10-Math.random()*20;const s=Math.random()*8+4;const sy=Math.random()*1.5+0.5;const sx=(Math.random()-0.5)*1;const r=Math.random()*Math.PI*2;const rs=(Math.random()-0.5)*0.02;const c=colors[Math.floor(Math.random()*colors.length)];particles.push({x,y,s,sy,sx,c,r,rs,o:1});} function drawS(x,y,rad,col,rot,op){ctx.save();ctx.globalAlpha=op;ctx.fillStyle=col;ctx.translate(x,y);ctx.rotate(rot);ctx.beginPath();for(let i=0;i<5;i++){ctx.lineTo(Math.cos((18+i*72)/180*Math.PI)*rad,-Math.sin((18+i*72)/180*Math.PI)*rad);ctx.lineTo(Math.cos((54+i*72)/180*Math.PI)*rad*0.5,-Math.sin((54+i*72)/180*Math.PI)*rad*0.5);} ctx.closePath();ctx.fill();ctx.restore();} function animC(){if(!canvas || canvas.width === 0 || canvas.height === 0) { animId = requestAnimationFrame(animC); return; } ctx.clearRect(0,0,canvas.width,canvas.height);if(particles.length<100&&Math.random()>0.90){createP();} particles.forEach((p,i)=>{p.y+=p.sy;p.x+=p.sx;p.r+=p.rs;p.o-=0.005;if(p.o<=0||p.y>canvas.height+10){particles.splice(i,1);}else{drawS(p.x,p.y,p.s,p.c,p.r,p.o);}}); animId=requestAnimationFrame(animC);} if(canvas.dataset.animId){cancelAnimationFrame(parseInt(canvas.dataset.animId));} animC(); canvas.dataset.animId=animId;
             }


            // --- CORE NAVIGATION LOGIC ---
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const mainNavLinks = document.querySelectorAll('#nav-links > a.nav-link-style, #nav-links > button#login-button, #nav-links > a#portal-link');
            const mobileNavLinks = document.querySelectorAll('#mobile-menu > a');

            const pages = {
                'home': document.getElementById('home-page'),
                'coaches': document.getElementById('coaches-page'),
                'teams': document.getElementById('teams-page'),
                'team-detail': document.getElementById('team-detail-page'),
                'clubs': document.getElementById('clubs-page'),
                'club-detail': document.getElementById('club-detail-page'),
                'upcoming': document.getElementById('upcoming-page'),
                'news': document.getElementById('news-page'),
                'news-detail': document.getElementById('news-detail-page'),
                'pta': document.getElementById('pta-page'),
                'portal': document.getElementById('portal-page'),
                'membership': document.getElementById('membership-page'),
                'donate': document.getElementById('donation-page'),
                'store': document.getElementById('store-page'),
                'raffle': document.getElementById('raffle-page'),
                'raffle-leaderboard': document.getElementById('raffle-leaderboard-page')
             };

             // Globally expose showPage
             window.showPage = function(pageId, dataName, scrollToId) {
                 console.log(`Navigating to page: ${pageId}`);
                 const requiresLoginPages = ['portal']; // Only portal requires full login
                 let userLoggedIn = window.firebase?.auth?.currentUser;
                 const authOverlay = document.getElementById('auth-overlay');
                 const authMessage = document.getElementById('auth-message');
                 const loginContainer = document.getElementById('login-container');
                 const signupContainer = document.getElementById('signup-container');
                 const forgotPasswordContainer = document.getElementById('forgot-password-container');

                 // Check 1: Must be logged in for login-required pages
                 if (requiresLoginPages.includes(pageId) && !userLoggedIn) {
                     console.log("Access denied: User not logged in. Showing auth overlay.");
                     if(authMessage) { authMessage.textContent = 'Please log in to access this page.'; authMessage.className = 'text-center mt-4 font-medium text-red-500'; }
                     signupContainer?.classList.add('hidden'); forgotPasswordContainer?.classList.add('hidden'); loginContainer?.classList.remove('hidden');
                     authOverlay?.classList.remove('hidden'); authOverlay?.classList.add('flex');
                     return; // Stop navigation
                 }

                 // Check 2: Must be email-verified for login-required pages
                 if (requiresLoginPages.includes(pageId) && userLoggedIn && !userLoggedIn.emailVerified) {
                     console.log("Access denied: Email not verified. Showing auth overlay.");
                     if(authMessage) { authMessage.textContent = 'Please verify your email to access the portal. Check your inbox/spam.'; authMessage.className = 'text-center mt-4 font-medium text-red-500'; }
                     signupContainer?.classList.add('hidden'); forgotPasswordContainer?.classList.add('hidden'); loginContainer?.classList.remove('hidden');
                     authOverlay?.classList.remove('hidden'); authOverlay?.classList.add('flex');
                     // Don't sign out, just show message
                     return; // Stop navigation
                 }
                 
                 // Check 3: Portal page logic is now handled by loadPortalData (which sections to show)
                 // No need to redirect away from 'portal' page if not a member

                 // Check 4: Update Membership page UI based on login state
                 if (pageId === 'membership') {
                     if (window.updateMembershipPageUI) window.updateMembershipPageUI(userLoggedIn);
                 }
                 // Check 5: Update Raffle page UI based on login state
                 if (pageId === 'raffle') {
                     if (window.updateRafflePageUI) window.updateRafflePageUI(userLoggedIn);
                 }
                 // Check 6: Update Leaderboard page UI based on login state
                 if (pageId === 'raffle-leaderboard') {
                    const refLinkContainer = document.getElementById('referral-link-container');
                    const loginForRefLink = document.getElementById('login-for-referral-link');
                    const refLinkInput = document.getElementById('referral-link');
                    if(userLoggedIn && userLoggedIn.emailVerified) {
                        refLinkContainer?.classList.remove('hidden');
                        loginForRefLink?.classList.add('hidden');
                        if(refLinkInput) refLinkInput.value = `https://frazerhub.com/raffle?ref=${userLoggedIn.uid}`; // Use UID for ref
                    } else {
                        refLinkContainer?.classList.add('hidden');
                        loginForRefLink?.classList.remove('hidden');
                    }
                 }
                 
                 // Check 7: Update Store page UI
                 if (pageId === 'store') {
                    const cartButton = document.getElementById('cart-button');
                    if(userLoggedIn && cartButton) {
                        cartButton.classList.remove('hidden');
                    } else if (cartButton) {
                        cartButton.classList.add('hidden');
                    }
                 } else {
                    const cartButton = document.getElementById('cart-button');
                    if (cartButton) cartButton.classList.add('hidden');
                 }


                 // --- Page Population ---
                 if (pageId === 'team-detail' && dataName && teamsData[dataName]) {
                     const team = teamsData[dataName];
                     document.getElementById('team-detail-heading').textContent = dataName;
                     document.getElementById('team-detail-what').textContent = team.what;
                     document.getElementById('team-detail-do').textContent = team.do;
                     const coachesContainer = document.getElementById('team-detail-coaches');
                     if(coachesContainer){ coachesContainer.innerHTML = ''; if(team.coaches?.length > 0) { team.coaches.forEach(coach => { coachesContainer.innerHTML += `<div class="text-center"><img src="${coach.photo}" alt="${coach.name}" class="w-32 h-32 rounded-full mx-auto mb-4 shadow-md"><h4 class="text-xl font-bold text-brand-navy">${coach.name}</h4><p class="text-brand-grey">${coach.title}</p><a href="mailto:${coach.email}" class="text-brand-red hover:underline">${coach.email}</a></div>`; }); } else { coachesContainer.innerHTML = '<p>No coaches listed.</p>'; } }
                     document.getElementById('breadcrumb-nav').innerHTML = `<a href="#" data-page="home" class="text-brand-red hover:underline">Home</a><span class="mx-2 text-gray-400">/</span><a href="#" data-page="teams" class="text-brand-red hover:underline">Teams</a><span class="mx-2 text-gray-400">/</span><span class="font-semibold text-brand-navy">${dataName}</span>`;
                     const awardsContainer = document.getElementById('team-detail-awards');
                     if(awardsContainer) { awardsContainer.innerHTML = ''; if (team.awards?.length > 0) { team.awards.forEach(awardImg => { awardsContainer.innerHTML += `<img src="${awardImg}" alt="Award photo for ${dataName}" class="rounded-lg shadow-md">`; }); } else { awardsContainer.innerHTML = '<p>No awards yet.</p>'; } }
                 }
                  if (pageId === 'club-detail' && dataName && clubsData[dataName]) {
                     const club = clubsData[dataName];
                     document.getElementById('club-detail-heading').textContent = dataName;
                     document.getElementById('club-detail-description').textContent = club.description;
                     document.getElementById('club-detail-meetings').textContent = club.meetings;
                     const sponsorContainer = document.getElementById('club-detail-sponsor');
                     if(sponsorContainer) { sponsorContainer.innerHTML = ''; if(club.sponsor) { sponsorContainer.innerHTML = `<div class="text-center"><img src="${club.sponsor.photo}" alt="${club.sponsor.name}" class="w-32 h-32 rounded-full mx-auto mb-4 shadow-md"><h4 class="text-xl font-bold text-brand-navy">${club.sponsor.name}</h4><p class="text-brand-grey">${club.sponsor.title}</p><a href="mailto:${club.sponsor.email}" class="text-brand-red hover:underline">${club.sponsor.email}</a></div>`; } }
                     document.getElementById('club-breadcrumb-nav').innerHTML = `<a href="#" data-page="home" class="text-brand-red hover:underline">Home</a><span class="mx-2 text-gray-400">/</span><a href="#" data-page="clubs" class="text-brand-red hover:underline">Clubs</a><span class="mx-2 text-gray-400">/</span><span class="font-semibold text-brand-navy">${dataName}</span>`;
                     const galleryContainer = document.getElementById('club-detail-gallery');
                     if(galleryContainer) { galleryContainer.innerHTML = ''; if (club.gallery?.length > 0) { club.gallery.forEach(imgUrl => { galleryContainer.innerHTML += `<img src="${imgUrl}" alt="Gallery photo for ${dataName}" class="rounded-lg shadow-md">`; }); } else { galleryContainer.innerHTML = '<p>No photos yet.</p>'; } }
                  }
                  if (pageId === 'news-detail' && dataName) {
                     const article = newsData.find(a => a.title === dataName);
                     if (article) {
                         document.getElementById('news-detail-heading').textContent = article.title;
                         document.getElementById('news-detail-meta').textContent = `By ${article.author} on ${article.date.toLocaleDateString()}`;
                         const imgEl = document.getElementById('news-detail-image'); if (imgEl) { imgEl.src = article.image; imgEl.alt = article.title; }
                         document.getElementById('news-detail-content').innerHTML = article.fullContent;
                         document.getElementById('news-breadcrumb-nav').innerHTML = `<a href="#" data-page="home" class="text-brand-red hover:underline">Home</a> &gt; <a href="#" data-page="news" class="text-brand-red hover:underline">News</a> &gt; <span class="text-brand-grey">${article.title}</span>`;
                     }
                  }


                 // Hide all pages
                 Object.values(pages).forEach(page => {
                     if (page) {
                         if (page.id === 'home-page' && !page.classList.contains('hidden') && pageId !== 'home') {
                             if (currentCountdownInterval) { clearInterval(currentCountdownInterval); currentCountdownInterval = null; console.log("Cleared countdown interval."); }
                         }
                         page.classList.add('hidden');
                     }
                 });

                 // Show the target page
                 const newPage = pages[pageId];
                 if (newPage) {
                     newPage.classList.remove('hidden');
                     if (pageId === 'home') { displayUpcomingEvent(); } // Restart countdown
                     if (pageId === 'membership' && userLoggedIn && window.firebase?.db) {
                         // Pre-select membership level based on current status
                         const userDocRef = window.firebase.doc(window.firebase.db, "users", userLoggedIn.uid);
                         window.firebase.getDoc(userDocRef).then(docSnap => {
                             if(docSnap.exists() && docSnap.data().membershipLevel) {
                                 const level = docSnap.data().membershipLevel;
                                 const radio = document.getElementById(`level-${level.toLowerCase()}`);
                                 if (radio) radio.checked = true;
                             }
                         }).catch(err => console.error("Error getting user doc for membership:", err));
                     }
                 } else {
                     console.error(`Page with ID "${pageId}" not found.`);
                     pages['home']?.classList.remove('hidden'); pageId = 'home';
                 }

                 // Scrolling
                 if (scrollToId) { const el = document.querySelector(scrollToId); if (el) setTimeout(() => el.scrollIntoView({ behavior: 'smooth' }), 50); }
                 else { window.scrollTo({ top: 0, behavior: 'smooth' }); }

                 // Update active nav link
                 let activeNavPage = pageId;
                 if (['team-detail', 'club-detail', 'news-detail'].includes(pageId)) { const map = { 'team-detail': 'teams', 'club-detail': 'clubs', 'news-detail': 'news' }; activeNavPage = map[pageId]; }
                 if (pageId === 'membership') { activeNavPage = 'membership'; }
                 if (pageId === 'portal') { activeNavPage = 'portal'; }
                 if (pageId === 'donate' || pageId === 'donor-wall') { activeNavPage = 'donate'; }
                 if (pageId === 'store') { activeNavPage = 'store'; }
                 if (pageId === 'raffle' || pageId === 'raffle-leaderboard') { activeNavPage = 'raffle'; }

                 const updateLinks = (links) => { links.forEach(link => { link.classList.remove('active'); const linkPage = link.dataset.page; const linkScroll = link.dataset.scroll||null; const reqScroll = scrollToId||null; if (linkPage === activeNavPage && linkScroll === reqScroll) link.classList.add('active'); }); };
                 updateLinks(mainNavLinks); updateLinks(mobileNavLinks);
             }
            
             // Define updateMembershipPageUI globally
             window.updateMembershipPageUI = function(user) {
                const paymentSection = document.getElementById('payment-section');
                const loginToJoinSection = document.getElementById('login-to-join-section');
                if (!paymentSection || !loginToJoinSection) return;

                if (user && user.emailVerified) { // Only show payment if logged in AND verified
                    paymentSection.classList.remove('hidden');
                    loginToJoinSection.classList.add('hidden');
                } else {
                    paymentSection.classList.add('hidden');
                    loginToJoinSection.classList.remove('hidden');
                }
             }
             
             // Define updateRafflePageUI globally
             window.updateRafflePageUI = function(user) {
                const rafflePaymentSection = document.getElementById('raffle-payment-section');
                const loginToParticipateSection = document.getElementById('login-to-participate-section');
                if (!rafflePaymentSection || !loginToParticipateSection) return;

                if (user && user.emailVerified) { // Only show payment if logged in AND verified
                    rafflePaymentSection.classList.remove('hidden');
                    loginToParticipateSection.classList.add('hidden');
                } else {
                    rafflePaymentSection.classList.add('hidden');
                    loginToParticipateSection.classList.remove('hidden');
                }
             }


            mobileMenuButton?.addEventListener('click', () => mobileMenu?.classList.toggle('hidden'));
            document.body.addEventListener('click', function(e) {
                 const pageLinkTarget = e.target.closest('a[data-page], button[data-page]');
                 if (pageLinkTarget) {
                     if ((pageLinkTarget.tagName === 'A' && pageLinkTarget.getAttribute('href') === '#') || (pageLinkTarget.tagName === 'BUTTON' && pageLinkTarget.dataset.page)) {
                         e.preventDefault();
                     }
                     if (!['login-button', 'mobile-login-button', 'logout-button', 'mobile-logout-button', 'join-now-login-button', 'raffle-login-button', 'leaderboard-login-button'].includes(pageLinkTarget.id)) {
                          if (window.showPage) window.showPage(pageLinkTarget.dataset.page, pageLinkTarget.dataset.team || pageLinkTarget.dataset.club || pageLinkTarget.dataset.news, pageLinkTarget.dataset.scroll);
                          else console.error("showPage function not yet available");
                     }
                     if (mobileMenu && !mobileMenu.classList.contains('hidden')) mobileMenu.classList.add('hidden');
                 } else if (mobileMenu && !mobileMenu.classList.contains('hidden') && !e.target.closest('header')) {
                      mobileMenu.classList.add('hidden');
                 }
            });

            // --- INITIAL SETUP AND UI HANDLERS ---
             Object.values(pages).forEach(page => { if (page) { page.classList.add('page', 'hidden'); }});
             pages['home']?.classList.remove('hidden');

            // Reveal elements
            const revealElements = document.querySelectorAll('.reveal');
            const observer = new IntersectionObserver((entries) => { entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); }); }, { threshold: 0.1 });
            revealElements.forEach(el => observer.observe(el));

            // Back to top
            const backToTopButton = document.getElementById('back-to-top');
            window.addEventListener('scroll', () => { backToTopButton?.classList.toggle('visible', window.scrollY > 400); });
            backToTopButton?.addEventListener('click', (e) => { e.preventDefault(); window.scrollTo({ top: 0, behavior: 'smooth' }); });

            // Footer Year
            const yearSpan = document.getElementById('year'); if(yearSpan) yearSpan.textContent = new Date().getFullYear();

            // --- SEARCH FUNCTIONALITY ---
             const searchButton = document.getElementById('search-button'); const searchOverlay = document.getElementById('search-overlay'); const closeSearchButton = document.getElementById('close-search-button'); const searchInput = document.getElementById('search-input'); const searchResultsContainer = document.getElementById('search-results-container'); const searchableData = []; Object.keys(teamsData).forEach(n=>searchableData.push({name:n,type:'Team',page:'team-detail',key:n})); Object.keys(clubsData).forEach(n=>searchableData.push({name:n,type:'Club',page:'club-detail',key:n})); eventsData.forEach(e=>searchableData.push({name:e.name,type:'Event',page:'upcoming',key:null})); newsData.forEach(n=>searchableData.push({name:n.title,type:'News',page:'news-detail',key:n.title})); searchButton?.addEventListener('click', ()=>{ searchOverlay?.classList.remove('hidden'); searchOverlay?.classList.add('flex'); searchInput?.focus(); }); closeSearchButton?.addEventListener('click', ()=>{ searchOverlay?.classList.add('hidden'); searchOverlay?.classList.remove('flex'); if(searchInput) searchInput.value = ''; if(searchResultsContainer) searchResultsContainer.innerHTML = ''; }); searchInput?.addEventListener('input', (e)=>{ const q=e.target.value.toLowerCase().trim(); if(!searchResultsContainer)return; if(q.length<2){searchResultsContainer.innerHTML='<p class="text-center text-gray-500">Please enter at least 2 characters.</p>';return;} const res=searchableData.filter(i=>i.name.toLowerCase().includes(q)); if(res.length>0){searchResultsContainer.innerHTML=res.map(i=>{let dA=''; if(i.type==='Team')dA=`data-team="${i.key}"`; else if(i.type==='Club')dA=`data-club="${i.key}"`; else if(i.type==='News')dA=`data-news="${i.key}"`; return `<a href="#" class="block p-4 hover:bg-gray-100 rounded-lg" data-page="${i.page}" ${dA}><p class="font-bold text-brand-navy">${i.name}</p><p class="text-sm text-brand-red">${i.type}</p></a>`;}).join('');}else{searchResultsContainer.innerHTML='<p class="text-center text-gray-500">No results found.</p>';}});

            // --- COACHES PAGE POPULATION ---
            populateCoachesPage();
            function populateCoachesPage() { const all={}; Object.values(teamsData).forEach(t=>t.coaches?.forEach(c=>{if(!all[c.email])all[c.email]={...c,type:'coach'};})); Object.values(clubsData).forEach(cl=>{if(cl.sponsor&&!all[cl.sponsor.email])all[cl.sponsor.email]={...cl.sponsor,type:'sponsor'};}); const cats={math:['rogers@email.com','stark@email.com','prince@email.com'],science:['white@email.com','adams@email.com','clark@email.com','kent@email.com'],misc:[]}; Object.keys(all).forEach(em=>{if(!cats.math.includes(em)&&!cats.science.includes(em))cats.misc.push(em);}); const cardHTML=c=>`<div class="bento-item text-center"><img src="${c.photo}" alt="${c.name}" class="w-32 h-32 rounded-full mx-auto mb-4 shadow-md"><h4 class="text-xl font-bold text-brand-navy">${c.name}</h4><p class="text-brand-grey">${c.title}</p><a href="mailto:${c.email}" class="text-brand-red hover:underline">${c.email}</a></div>`; ['math','science','misc'].forEach(cat=>{const g=document.getElementById(`${cat}-coaches-grid`); if(g){g.innerHTML=''; cats[cat].slice(0,4).forEach(em=>{const c=all[em];if(c)g.innerHTML+=cardHTML(c);}); if(g.innerHTML==='')g.innerHTML='<p class="col-span-full text-center">No coaches found.</p>';}}); }

            // --- AUTH OVERLAY LOGIC (Managed by module script) ---
            const closeAuthButton = document.getElementById('close-auth-button');
            const authOverlay = document.getElementById('auth-overlay');
            closeAuthButton?.addEventListener('click', () => { authOverlay?.classList.add('hidden'); authOverlay?.classList.remove('flex'); });
            // Other toggles are in module script

            // --- RUN ON LOAD ---
            displayUpcomingEvent(); // Call initially
            startStarConfetti('confetti-canvas');
            // Populate coaches called above
        });
    </script>
</body>
</html>

